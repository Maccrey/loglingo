(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,76533,55749,e=>{"use strict";var t=e.i(82252),a=e.i(59372),s=e.i(992);let r=a.forwardRef(({className:e,type:a,...r},i)=>(0,t.jsx)("input",{type:a,className:(0,s.cn)("flex h-10 w-full rounded-lg border border-white/10 bg-white/5 px-3 py-2 text-sm text-foreground placeholder:text-white/40 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary disabled:cursor-not-allowed disabled:opacity-50 backdrop-blur-sm transition-all hover:bg-white/10",e),ref:i,...r}));function i(t,a){e.A(30425).then(e=>e.logAnalyticsEvent(t,a)).catch(()=>{})}r.displayName="Input",e.s(["Input",()=>r],76533),e.i(60109),e.s(["trackEvent",()=>i],55749)},76083,e=>{"use strict";let t=(0,e.i(86146).default)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);e.s(["Trash2",()=>t],76083)},91849,e=>{"use strict";var t=e.i(82252),a=e.i(59372),s=e.i(59427),r=e.i(76533),i=e.i(86823),n=e.i(90798),l=e.i(32823),d=e.i(80798),o=e.i(86146);let c=(0,o.default)("image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);var u=e.i(28882),m=e.i(7591),h=e.i(76083),x=e.i(45348),p=e.i(89877),g=e.i(78384),f=e.i(31331),y=e.i(992);let j=(0,o.default)("info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),v=(0,o.default)("wand-sparkles",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]]);var b=e.i(60211);function N({issue:e}){return(0,t.jsxs)("div",{className:"rounded-lg border border-white/10 bg-white/5 p-3",children:[(0,t.jsx)("p",{className:"text-xs uppercase text-primary mb-1",children:e.type}),(0,t.jsxs)("p",{className:"text-sm text-foreground",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Original:"})," ",e.original]}),(0,t.jsxs)("p",{className:"text-sm text-foreground",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Suggestion:"})," ",e.suggestion]}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:e.explanation})]})}function w({result:e,onApply:a,applying:s,onSaveArchive:r,savingArchive:n}){let l=(0,p.useTranslations)("ai");return(0,t.jsxs)(i.Card,{className:"border-primary/30 bg-primary/5",children:[(0,t.jsxs)(i.CardHeader,{className:"flex flex-row items-center justify-between space-y-0",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(m.Sparkles,{className:"h-5 w-5 text-primary"}),(0,t.jsx)(i.CardTitle,{children:l("result_title")})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[r&&(0,t.jsxs)("button",{className:(0,y.cn)("inline-flex items-center rounded-lg bg-white/10 px-3 py-1.5 text-xs font-medium text-foreground transition hover:bg-white/20",n&&"opacity-70"),onClick:r,disabled:n,children:[(0,t.jsx)(b.Archive,{className:"mr-2 h-4 w-4"}),l(n?"saving":"save_archive")]}),a&&(0,t.jsxs)("button",{className:(0,y.cn)("inline-flex items-center rounded-lg bg-gradient-to-r from-primary to-accent px-3 py-1.5 text-xs font-medium text-primary-foreground shadow transition hover:opacity-90",s&&"opacity-70"),onClick:()=>a(e.corrected),disabled:s,children:[(0,t.jsx)(v,{className:"mr-2 h-4 w-4"}),l(s?"applying":"apply")]})]})]}),(0,t.jsxs)(i.CardContent,{className:"space-y-4",children:[(0,t.jsx)("div",{className:"rounded-lg border border-primary/30 bg-black/20 p-3 text-sm leading-relaxed",children:e.corrected}),e.rootMeaningGuide&&(0,t.jsxs)("div",{className:"flex items-start gap-2 rounded-lg border border-white/10 bg-white/5 p-3 text-sm text-muted-foreground",children:[(0,t.jsx)(j,{className:"h-4 w-4 text-primary mt-0.5"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium text-foreground",children:l("root_meaning")}),(0,t.jsx)("p",{children:e.rootMeaningGuide})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("p",{className:"text-sm font-semibold text-foreground",children:l("issues")}),e.issues?.length?(0,t.jsx)("div",{className:"grid gap-2 md:grid-cols-2",children:e.issues.map((e,a)=>(0,t.jsx)(N,{issue:e},a))}):(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:l("no_issues")})]})]})]})}async function k(e){let t=new AbortController,a=setTimeout(()=>t.abort(new DOMException("AI request timed out","TimeoutError")),3e4),s=JSON.stringify({content:e.content,mode:e.mode||"full",locale:e.locale,learningLanguage:e.learningLanguage,targetLanguage:e.targetLanguage??e.learningLanguage??e.locale});try{let a=await fetch("/api/ai/correct",{method:"POST",headers:{"Content-Type":"application/json"},body:s,signal:e.signal??t.signal});if(!a.ok){let e=await a.json().catch(()=>null);throw Error(e?.message||"AI request failed")}return await a.json()}finally{clearTimeout(a)}}var C=e.i(55749),_=e.i(73406),S=e.i(44016),M=e.i(39322),A=e.i(56036);function T({initial:o,onSubmit:y,onDelete:j,isSubmitting:v}){let b=(0,p.useTranslations)("write"),N=(0,p.useTranslations)("diary"),T=(0,x.useLocale)(),L=(0,g.useRouter)(),E=(0,S.getCurrentUserId)()||A.auth.currentUser?.uid||"",{learningLanguage:I}=(0,M.useLearningLanguage)(),{create:D}=(0,_.useArchiveMutations)(E),B={"invalid-date":"validation_invalid_date","empty-content":"validation_empty_content","too-long":"validation_too_long"},[P,G]=(0,a.useState)(o?.date??new Date().toISOString().split("T")[0]),[H,U]=(0,a.useState)(o?.content??""),[z,O]=(0,a.useState)(null),[q,F]=(0,a.useState)(o?.imageUrl),[R,V]=(0,a.useState)(!1),[$,K]=(0,a.useState)(0),[J,W]=(0,a.useState)([]),[Q,X]=(0,a.useState)(!1),[Y,Z]=(0,a.useState)(null),[ee,et]=(0,a.useState)(!1),[ea,es]=(0,a.useState)(!1);(0,a.useEffect)(()=>{o&&(G(o.date),U(o.content),F(o.imageUrl),V(!1),O(null))},[o]);let er=async e=>{e&&(e.type.startsWith("image/")?(V(!1),O(e),F(await (0,l.getImagePreview)(e))):d.toast.error(b("validation_image")))},ei=()=>{let e=document.createElement("input");e.type="file",e.accept="image/*",e.onchange=e=>{let t=e.target;er(t.files?.[0]||void 0)},e.click()},en=async e=>{e.preventDefault(),W([]);try{await y({date:P,content:H,imageFile:z,removeImage:R,onUploadProgress:e=>K(e)}),d.toast.success(b("saved")),K(0),o||(U(""),O(null),F(void 0))}catch(e){if(e instanceof n.DiaryValidationError)return void W(e.reasons);d.toast.error(b("upload_failed"))}},el=async()=>{if(j&&confirm(N("confirm_delete")))try{X(!0),await j(),d.toast.success(N("delete_success")),L.push("/diary")}catch{d.toast.error(N("delete_error"))}finally{X(!1)}},ed=async()=>{if(!H.trim())return void d.toast.error(b("validation_empty_content"));et(!0),Z(null),(0,C.trackEvent)("ai_correct_clicked",{mode:"full"});try{let e=await k({content:H,mode:"full",locale:T,targetLanguage:I||T,learningLanguage:I});Z(e),(0,C.trackEvent)("ai_correct_success")}catch(t){let e=t instanceof Error?t.message:"unknown";(0,C.trackEvent)("ai_correct_failure",{message:e}),d.toast.error(b("ai_error"))}finally{et(!1)}},eo=async e=>{U(e),d.toast.success(b("ai_applied")),await ec()},ec=async()=>{if(Y&&E)try{es(!0);let t=[];if(Y.corrected.trim()&&Y.rootMeaningGuide){let a=Y.corrected.slice(0,80),{checkDuplicate:s}=await e.A(12485);await s(E,a)?console.log("⏭️ Skipping duplicate:",a):t.push({userId:E,type:"grammar",title:a,rootMeaning:Y.rootMeaningGuide,examples:[Y.corrected],sourceId:o?.id})}for(let a of Y.issues||[]){let s=a.suggestion.slice(0,80),{checkDuplicate:r}=await e.A(12485);await r(E,s)?console.log("⏭️ Skipping duplicate:",s):t.push({userId:E,type:"grammar",title:s,rootMeaning:a.explanation||Y.rootMeaningGuide||"AI suggestion",examples:[a.original,a.suggestion].filter(Boolean),sourceId:o?.id})}t.length>0?(await Promise.all(t.map(e=>D.mutateAsync(e))),d.toast.success(b("ai_saved_archive"))):d.toast.info("모두 이미 아카이브에 저장되어 있습니다")}catch(t){let e=t instanceof Error?t.message:"error";d.toast.error(`${b("upload_failed")} (${e})`)}finally{es(!1)}};return(0,t.jsxs)("form",{onSubmit:en,className:"space-y-6",children:[(0,t.jsxs)(i.Card,{children:[(0,t.jsx)(i.CardHeader,{children:(0,t.jsx)(i.CardTitle,{children:o?b("edit_title"):b("title")})}),(0,t.jsxs)(i.CardContent,{className:"space-y-4",children:[J.length>0&&(0,t.jsx)("div",{className:"rounded-lg border border-red-500/40 bg-red-500/10 p-3 text-sm text-red-200",children:(0,t.jsx)("ul",{className:"space-y-1",children:J.map(e=>(0,t.jsx)("li",{children:b(B[e]??"validation_invalid_date")},e))})}),(0,t.jsxs)("div",{className:"flex flex-col space-y-2",children:[(0,t.jsx)("label",{htmlFor:"date",className:"text-sm font-medium text-muted-foreground",children:b("date_label")}),(0,t.jsx)(r.Input,{id:"date",type:"date",value:P,onChange:e=>G(e.target.value),className:"w-full sm:w-auto",required:!0})]}),(0,t.jsxs)("div",{className:"flex flex-col space-y-2",children:[(0,t.jsx)("label",{htmlFor:"content",className:"text-sm font-medium text-muted-foreground",children:b("content_label")}),(0,t.jsx)("textarea",{id:"content",className:"min-h-[300px] w-full rounded-lg border border-white/10 bg-white/5 p-4 text-base text-foreground placeholder:text-white/40 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary backdrop-blur-sm resize-none",placeholder:b("placeholder"),value:H,onChange:e=>U(e.target.value),required:!0}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:b("upload_hint")})]}),(0,t.jsx)("div",{className:"flex flex-col gap-3",children:q?(0,t.jsxs)("div",{className:"relative overflow-hidden rounded-lg border border-white/10 bg-white/5 p-2",children:[(0,t.jsx)(f.default,{src:q,alt:"Diary attachment",width:1200,height:800,className:"h-48 w-full rounded-md object-cover",loading:"lazy",sizes:"(max-width: 768px) 100vw, 640px"}),(0,t.jsxs)("div",{className:"mt-2 flex items-center gap-2",children:[(0,t.jsxs)(s.Button,{type:"button",variant:"secondary",size:"sm",onClick:()=>{V(!0),F(void 0),O(null)},children:[(0,t.jsx)(h.Trash2,{className:"mr-2 h-4 w-4"}),b("remove_image")]}),(0,t.jsx)(s.Button,{type:"button",variant:"ghost",size:"sm",onClick:()=>{V(!1),ei()},children:b("replace_image")})]})]}):(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)(s.Button,{type:"button",variant:"secondary",size:"sm",onClick:ei,children:[(0,t.jsx)(c,{className:"mr-2 h-4 w-4"}),b("upload_image")]}),(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:b("upload_hint")})]})}),$>0&&$<100&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[(0,t.jsx)(u.Loader2,{className:"h-4 w-4 animate-spin"}),b("uploading")," ",$,"%"]}),(0,t.jsx)("div",{className:"h-2 rounded-full bg-white/10",children:(0,t.jsx)("div",{className:"h-full rounded-full bg-gradient-to-r from-primary to-accent transition-all",style:{width:`${$}%`}})})]})]}),(0,t.jsxs)(i.CardFooter,{className:"flex flex-wrap items-center justify-between gap-3",children:[(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(s.Button,{type:"button",variant:"ghost",onClick:()=>L.push("/diary"),children:b("back")}),(0,t.jsxs)(s.Button,{type:"button",variant:"glass",onClick:ed,disabled:ee,className:"border-primary/60 bg-primary/10 text-primary hover:bg-primary/20 hover:text-primary-foreground",children:[ee?(0,t.jsx)(u.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}):(0,t.jsx)(m.Sparkles,{className:"mr-2 h-4 w-4"}),ee?b("ai_checking"):b("ai_check")]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[j&&(0,t.jsxs)(s.Button,{type:"button",variant:"ghost",onClick:el,disabled:Q,children:[(0,t.jsx)(h.Trash2,{className:"mr-2 h-4 w-4"}),N("delete")]}),(0,t.jsxs)(s.Button,{type:"submit",disabled:v||Q,className:"bg-gradient-to-r from-primary to-accent hover:opacity-90 border-0",children:[v&&(0,t.jsx)(u.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),o?b("update"):b("save")]})]})]})]}),Y&&(0,t.jsx)(w,{result:Y,onApply:eo,applying:v,onSaveArchive:ec,savingArchive:ea})]})}e.s(["DiaryForm",()=>T],91849)},29241,e=>{"use strict";var t=e.i(82252),a=e.i(59372),s=e.i(91849),r=e.i(10551),i=e.i(73406),n=e.i(44016),l=e.i(86823),d=e.i(89877),o=e.i(67502),c=e.i(78384),u=e.i(60211),m=e.i(7591);function h({params:e}){let{id:h}=(0,a.use)(e),x=(0,n.getCurrentUserId)(),p=(0,d.useTranslations)("diary"),g=(0,d.useTranslations)("archive"),f=(0,c.useRouter)(),{data:y,isLoading:j}=(0,r.useDiaryDetail)(x,h),{update:v,remove:b}=(0,r.useDiaryMutations)(x),{data:N=[],isLoading:w}=(0,i.useArchiveList)(x);return j?(0,t.jsx)(o.AuthGate,{children:(0,t.jsxs)(l.Card,{className:"max-w-3xl",children:[(0,t.jsx)(l.CardHeader,{children:(0,t.jsx)(l.CardTitle,{children:p("loading")})}),(0,t.jsx)(l.CardContent,{children:(0,t.jsx)("div",{className:"h-32 animate-pulse rounded-lg bg-white/5"})})]})}):y?(0,t.jsx)(o.AuthGate,{children:(0,t.jsxs)("div",{className:"mx-auto max-w-3xl space-y-6",children:[(0,t.jsx)(s.DiaryForm,{initial:y,onSubmit:async e=>{await v.mutateAsync({id:h,payload:e}),f.push("/diary")},onDelete:async()=>{await b.mutateAsync(h),f.push("/diary")},isSubmitting:v.isPending||b.isPending}),(0,t.jsxs)(l.Card,{children:[(0,t.jsx)(l.CardHeader,{children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(u.Archive,{className:"h-5 w-5 text-primary"}),(0,t.jsx)(l.CardTitle,{children:g("title")})]})}),(0,t.jsx)(l.CardContent,{children:w?(0,t.jsx)("div",{className:"h-20 animate-pulse rounded-lg bg-white/5"}):N.length>0?(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground mb-3",children:"이 일기에서 저장된 학습 항목들"}),N.slice(0,5).map(e=>(0,t.jsx)("div",{className:"rounded-lg border border-white/10 bg-white/5 p-3 hover:bg-white/10 transition-colors cursor-pointer",onClick:()=>f.push("/archive"),children:(0,t.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-foreground",children:e.title}),e.rootMeaning&&(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:e.rootMeaning})]}),(0,t.jsx)("span",{className:"text-xs px-2 py-1 rounded-full bg-primary/10 text-primary",children:"grammar"===e.type?"문법":"단어"})]})},e.id)),N.length>5&&(0,t.jsxs)("button",{onClick:()=>f.push("/archive"),className:"w-full text-sm text-primary hover:underline mt-2",children:["전체 보기 (",N.length,"개)"]})]}):(0,t.jsxs)("div",{className:"text-center py-6",children:[(0,t.jsx)(m.Sparkles,{className:"h-8 w-8 text-muted-foreground mx-auto mb-2"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"아직 저장된 학습 항목이 없습니다"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"AI 교정을 사용하면 자동으로 저장됩니다"})]})})]})]})}):(0,t.jsx)(o.AuthGate,{children:(0,t.jsxs)(l.Card,{className:"max-w-3xl",children:[(0,t.jsx)(l.CardHeader,{children:(0,t.jsx)(l.CardTitle,{children:p("not_found")})}),(0,t.jsx)(l.CardContent,{children:(0,t.jsx)("p",{className:"text-muted-foreground",children:p("not_found_desc")})})]})})}e.s(["default",()=>h])},30425,e=>{e.v(t=>Promise.all(["static/chunks/8ebcbc864680d81f.js"].map(t=>e.l(t))).then(()=>t(46352)))},12485,e=>{e.v(e=>Promise.resolve().then(()=>e(60125)))}]);