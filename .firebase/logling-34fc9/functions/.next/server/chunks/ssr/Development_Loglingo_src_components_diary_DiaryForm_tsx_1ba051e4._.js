module.exports=[56887,a=>{"use strict";var b=a.i(71544),c=a.i(62444),d=a.i(70611),e=a.i(80025),f=a.i(58081),g=a.i(42836),h=a.i(72222),i=a.i(98260),j=a.i(16195);let k=(0,j.default)("image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);var l=a.i(18220),m=a.i(28163),n=a.i(43726),o=a.i(5689),p=a.i(82969),q=a.i(82734),r=a.i(8593),s=a.i(83744);let t=(0,j.default)("info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),u=(0,j.default)("wand-sparkles",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]]);var v=a.i(38790);function w({issue:a}){return(0,b.jsxs)("div",{className:"rounded-lg border border-white/10 bg-white/5 p-3",children:[(0,b.jsx)("p",{className:"text-xs uppercase text-primary mb-1",children:a.type}),(0,b.jsxs)("p",{className:"text-sm text-foreground",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Original:"})," ",a.original]}),(0,b.jsxs)("p",{className:"text-sm text-foreground",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Suggestion:"})," ",a.suggestion]}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:a.explanation})]})}function x({result:a,onApply:c,applying:d,onSaveArchive:e,savingArchive:g}){let h=(0,p.useTranslations)("ai");return(0,b.jsxs)(f.Card,{className:"border-primary/30 bg-primary/5",children:[(0,b.jsxs)(f.CardHeader,{className:"flex flex-row items-center justify-between space-y-0",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(m.Sparkles,{className:"h-5 w-5 text-primary"}),(0,b.jsx)(f.CardTitle,{children:h("result_title")})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[e&&(0,b.jsxs)("button",{className:(0,s.cn)("inline-flex items-center rounded-lg bg-white/10 px-3 py-1.5 text-xs font-medium text-foreground transition hover:bg-white/20",g&&"opacity-70"),onClick:e,disabled:g,children:[(0,b.jsx)(v.Archive,{className:"mr-2 h-4 w-4"}),h(g?"saving":"save_archive")]}),c&&(0,b.jsxs)("button",{className:(0,s.cn)("inline-flex items-center rounded-lg bg-gradient-to-r from-primary to-accent px-3 py-1.5 text-xs font-medium text-primary-foreground shadow transition hover:opacity-90",d&&"opacity-70"),onClick:()=>c(a.corrected),disabled:d,children:[(0,b.jsx)(u,{className:"mr-2 h-4 w-4"}),h(d?"applying":"apply")]})]})]}),(0,b.jsxs)(f.CardContent,{className:"space-y-4",children:[(0,b.jsx)("div",{className:"rounded-lg border border-primary/30 bg-black/20 p-3 text-sm leading-relaxed",children:a.corrected}),a.rootMeaningGuide&&(0,b.jsxs)("div",{className:"flex items-start gap-2 rounded-lg border border-white/10 bg-white/5 p-3 text-sm text-muted-foreground",children:[(0,b.jsx)(t,{className:"h-4 w-4 text-primary mt-0.5"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium text-foreground",children:h("root_meaning")}),(0,b.jsx)("p",{children:a.rootMeaningGuide})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("p",{className:"text-sm font-semibold text-foreground",children:h("issues")}),a.issues?.length?(0,b.jsx)("div",{className:"grid gap-2 md:grid-cols-2",children:a.issues.map((a,c)=>(0,b.jsx)(w,{issue:a},c))}):(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:h("no_issues")})]})]})]})}async function y(a){let b=new AbortController,c=setTimeout(()=>b.abort(new DOMException("AI request timed out","TimeoutError")),3e4),d=JSON.stringify({content:a.content,mode:a.mode||"full",locale:a.locale,learningLanguage:a.learningLanguage,targetLanguage:a.targetLanguage??a.learningLanguage??a.locale});try{let c=await fetch("/api/ai/correct",{method:"POST",headers:{"Content-Type":"application/json"},body:d,signal:a.signal??b.signal});if(!c.ok){let a=await c.json().catch(()=>null);throw Error(a?.message||"AI request failed")}return await c.json()}finally{clearTimeout(c)}}var z=a.i(32564),A=a.i(16002),B=a.i(14476),C=a.i(90827),D=a.i(903);function E({initial:j,onSubmit:s,onDelete:t,isSubmitting:u}){let v=(0,p.useTranslations)("write"),w=(0,p.useTranslations)("diary"),E=(0,o.useLocale)(),F=(0,q.useRouter)(),G=(0,B.getCurrentUserId)()||D.auth.currentUser?.uid||"",{learningLanguage:H}=(0,C.useLearningLanguage)(),{create:I}=(0,A.useArchiveMutations)(G),J={"invalid-date":"validation_invalid_date","empty-content":"validation_empty_content","too-long":"validation_too_long"},[K,L]=(0,c.useState)(j?.date??new Date().toISOString().split("T")[0]),[M,N]=(0,c.useState)(j?.content??""),[O,P]=(0,c.useState)(null),[Q,R]=(0,c.useState)(j?.imageUrl),[S,T]=(0,c.useState)(!1),[U,V]=(0,c.useState)(0),[W,X]=(0,c.useState)([]),[Y,Z]=(0,c.useState)(!1),[$,_]=(0,c.useState)(null),[aa,ab]=(0,c.useState)(!1),[ac,ad]=(0,c.useState)(!1);(0,c.useEffect)(()=>{j&&(L(j.date),N(j.content),R(j.imageUrl),T(!1),P(null))},[j]);let ae=async a=>{a&&(a.type.startsWith("image/")?(T(!1),P(a),R(await (0,h.getImagePreview)(a))):i.toast.error(v("validation_image")))},af=()=>{let a=document.createElement("input");a.type="file",a.accept="image/*",a.onchange=a=>{let b=a.target;ae(b.files?.[0]||void 0)},a.click()},ag=async a=>{a.preventDefault(),X([]);try{await s({date:K,content:M,imageFile:O,removeImage:S,onUploadProgress:a=>V(a)}),i.toast.success(v("saved")),V(0),j||(N(""),P(null),R(void 0))}catch(a){if(a instanceof g.DiaryValidationError)return void X(a.reasons);i.toast.error(v("upload_failed"))}},ah=async()=>{if(t&&confirm(w("confirm_delete")))try{Z(!0),await t(),i.toast.success(w("delete_success")),F.push("/diary")}catch{i.toast.error(w("delete_error"))}finally{Z(!1)}},ai=async()=>{if(!M.trim())return void i.toast.error(v("validation_empty_content"));ab(!0),_(null),(0,z.trackEvent)("ai_correct_clicked",{mode:"full"});try{let a=await y({content:M,mode:"full",locale:E,targetLanguage:H||E,learningLanguage:H});_(a),(0,z.trackEvent)("ai_correct_success")}catch(b){let a=b instanceof Error?b.message:"unknown";(0,z.trackEvent)("ai_correct_failure",{message:a}),i.toast.error(v("ai_error"))}finally{ab(!1)}},aj=async a=>{N(a),i.toast.success(v("ai_applied")),await ak()},ak=async()=>{if($&&G)try{ad(!0);let b=[];if($.corrected.trim()&&$.rootMeaningGuide){let c=$.corrected.slice(0,80),{checkDuplicate:d}=await a.A(28920);await d(G,c)?console.log("⏭️ Skipping duplicate:",c):b.push({userId:G,type:"grammar",title:c,rootMeaning:$.rootMeaningGuide,examples:[$.corrected],sourceId:j?.id})}for(let c of $.issues||[]){let d=c.suggestion.slice(0,80),{checkDuplicate:e}=await a.A(28920);await e(G,d)?console.log("⏭️ Skipping duplicate:",d):b.push({userId:G,type:"grammar",title:d,rootMeaning:c.explanation||$.rootMeaningGuide||"AI suggestion",examples:[c.original,c.suggestion].filter(Boolean),sourceId:j?.id})}b.length>0?(await Promise.all(b.map(a=>I.mutateAsync(a))),i.toast.success(v("ai_saved_archive"))):i.toast.info("모두 이미 아카이브에 저장되어 있습니다")}catch(b){let a=b instanceof Error?b.message:"error";i.toast.error(`${v("upload_failed")} (${a})`)}finally{ad(!1)}};return(0,b.jsxs)("form",{onSubmit:ag,className:"space-y-6",children:[(0,b.jsxs)(f.Card,{children:[(0,b.jsx)(f.CardHeader,{children:(0,b.jsx)(f.CardTitle,{children:j?v("edit_title"):v("title")})}),(0,b.jsxs)(f.CardContent,{className:"space-y-4",children:[W.length>0&&(0,b.jsx)("div",{className:"rounded-lg border border-red-500/40 bg-red-500/10 p-3 text-sm text-red-200",children:(0,b.jsx)("ul",{className:"space-y-1",children:W.map(a=>(0,b.jsx)("li",{children:v(J[a]??"validation_invalid_date")},a))})}),(0,b.jsxs)("div",{className:"flex flex-col space-y-2",children:[(0,b.jsx)("label",{htmlFor:"date",className:"text-sm font-medium text-muted-foreground",children:v("date_label")}),(0,b.jsx)(e.Input,{id:"date",type:"date",value:K,onChange:a=>L(a.target.value),className:"w-full sm:w-auto",required:!0})]}),(0,b.jsxs)("div",{className:"flex flex-col space-y-2",children:[(0,b.jsx)("label",{htmlFor:"content",className:"text-sm font-medium text-muted-foreground",children:v("content_label")}),(0,b.jsx)("textarea",{id:"content",className:"min-h-[300px] w-full rounded-lg border border-white/10 bg-white/5 p-4 text-base text-foreground placeholder:text-white/40 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary backdrop-blur-sm resize-none",placeholder:v("placeholder"),value:M,onChange:a=>N(a.target.value),required:!0}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:v("upload_hint")})]}),(0,b.jsx)("div",{className:"flex flex-col gap-3",children:Q?(0,b.jsxs)("div",{className:"relative overflow-hidden rounded-lg border border-white/10 bg-white/5 p-2",children:[(0,b.jsx)(r.default,{src:Q,alt:"Diary attachment",width:1200,height:800,className:"h-48 w-full rounded-md object-cover",loading:"lazy",sizes:"(max-width: 768px) 100vw, 640px"}),(0,b.jsxs)("div",{className:"mt-2 flex items-center gap-2",children:[(0,b.jsxs)(d.Button,{type:"button",variant:"secondary",size:"sm",onClick:()=>{T(!0),R(void 0),P(null)},children:[(0,b.jsx)(n.Trash2,{className:"mr-2 h-4 w-4"}),v("remove_image")]}),(0,b.jsx)(d.Button,{type:"button",variant:"ghost",size:"sm",onClick:()=>{T(!1),af()},children:v("replace_image")})]})]}):(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)(d.Button,{type:"button",variant:"secondary",size:"sm",onClick:af,children:[(0,b.jsx)(k,{className:"mr-2 h-4 w-4"}),v("upload_image")]}),(0,b.jsx)("span",{className:"text-xs text-muted-foreground",children:v("upload_hint")})]})}),U>0&&U<100&&(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[(0,b.jsx)(l.Loader2,{className:"h-4 w-4 animate-spin"}),v("uploading")," ",U,"%"]}),(0,b.jsx)("div",{className:"h-2 rounded-full bg-white/10",children:(0,b.jsx)("div",{className:"h-full rounded-full bg-gradient-to-r from-primary to-accent transition-all",style:{width:`${U}%`}})})]})]}),(0,b.jsxs)(f.CardFooter,{className:"flex flex-wrap items-center justify-between gap-3",children:[(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(d.Button,{type:"button",variant:"ghost",onClick:()=>F.push("/diary"),children:v("back")}),(0,b.jsxs)(d.Button,{type:"button",variant:"glass",onClick:ai,disabled:aa,className:"border-primary/60 bg-primary/10 text-primary hover:bg-primary/20 hover:text-primary-foreground",children:[aa?(0,b.jsx)(l.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}):(0,b.jsx)(m.Sparkles,{className:"mr-2 h-4 w-4"}),aa?v("ai_checking"):v("ai_check")]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[t&&(0,b.jsxs)(d.Button,{type:"button",variant:"ghost",onClick:ah,disabled:Y,children:[(0,b.jsx)(n.Trash2,{className:"mr-2 h-4 w-4"}),w("delete")]}),(0,b.jsxs)(d.Button,{type:"submit",disabled:u||Y,className:"bg-gradient-to-r from-primary to-accent hover:opacity-90 border-0",children:[u&&(0,b.jsx)(l.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),j?v("update"):v("save")]})]})]})]}),$&&(0,b.jsx)(x,{result:$,onApply:aj,applying:u,onSaveArchive:ak,savingArchive:ac})]})}a.s(["DiaryForm",()=>E],56887)}];

//# sourceMappingURL=Development_Loglingo_src_components_diary_DiaryForm_tsx_1ba051e4._.js.map