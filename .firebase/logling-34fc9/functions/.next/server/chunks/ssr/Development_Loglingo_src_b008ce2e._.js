module.exports=[64856,a=>{"use strict";function b(a,b){let c="string"==typeof a?new Date(`${a}T00:00:00`):a;return new Intl.DateTimeFormat(b,{year:"numeric",month:"short",day:"numeric"}).format(c)}a.s(["formatDate",()=>b])},12834,a=>{"use strict";var b=a.i(903);a.i(91105);var c=a.i(93019);let d=(0,c.collection)(b.db,"learning_archive");function e(a){let b=a.data(),d=b.createdAt instanceof c.Timestamp?b.createdAt.toDate():new Date(b.createdAt??Date.now());return{id:a.id,userId:b.userId,type:b.type,title:b.title,examples:b.examples||[],rootMeaning:b.rootMeaning||"",sourceId:b.sourceId,createdAt:d}}async function f(a,b,f){if(console.log("ðŸ” Archive Repository: listArchive called",{userId:a,type:b,sourceId:f}),!a)return console.log("âš ï¸ Archive Repository: No userId, returning empty array"),[];try{let g=[(0,c.where)("userId","==",a)];b&&g.push((0,c.where)("type","==",b)),f&&g.push((0,c.where)("sourceId","==",f));let h=(0,c.query)(d,...g);console.log("ðŸ” Archive Repository: Executing query...");let i=(await (0,c.getDocs)(h)).docs.map(e);return i.sort((a,b)=>b.createdAt.getTime()-a.createdAt.getTime()),console.log("âœ… Archive Repository: Query complete",{count:i.length,results:i.slice(0,2)}),i}catch(a){throw console.error("âŒ Archive Repository: Query failed",a),a}}async function g(a,b){if(console.log("ðŸ” Archive Repository: checkDuplicate",{userId:a,title:b}),!a||!b)return!1;try{let e=(0,c.query)(d,(0,c.where)("userId","==",a),(0,c.where)("title","==",b)),f=!(await (0,c.getDocs)(e)).empty;return console.log(f?"âš ï¸ Archive Repository: Duplicate found":"âœ… Archive Repository: No duplicate"),f}catch(a){return console.error("âŒ Archive Repository: Check duplicate failed",a),!1}}async function h(a){let b={...a,createdAt:(0,c.serverTimestamp)()},f=await (0,c.addDoc)(d,b);return(await (0,c.getDocs)((0,c.query)(d,(0,c.where)("__name__","==",f.id)))).docs.map(e)[0]}a.s(["checkDuplicate",()=>g,"createArchive",()=>h,"listArchive",()=>f])},16002,a=>{"use strict";var b=a.i(93051),c=a.i(61738),d=a.i(81473),e=a.i(12834);async function f(a){if(!a.title.trim())throw Error("title-required");return(0,e.createArchive)({...a,examples:a.examples?.filter(Boolean)??[],rootMeaning:a.rootMeaning??""})}async function g(a,b,c){return(0,e.listArchive)(a,b,c)}function h(a){let b=a.options.map((a,b)=>({option:a,index:b})).sort(()=>Math.random()-.5),c=b.findIndex(b=>b.index===a.correctIndex);return{...a,options:b.map(a=>a.option),correctIndex:c}}var i=a.i(903);a.i(91105);var j=a.i(93019);let k=(0,j.collection)(i.db,"quizzes");function l(a){let b=a.data(),c=b.createdAt instanceof j.Timestamp?b.createdAt.toDate():new Date(b.createdAt??Date.now());return{id:a.id,archiveId:b.archiveId,question:b.question,options:b.options||[],correctIndex:b.correctIndex??0,explanation:b.explanation||"",createdAt:c}}async function m(a){if(console.log("ðŸ” Quiz Repository: getQuizByArchiveId called",{archiveId:a}),!a)return console.log("âš ï¸ Quiz Repository: No archiveId provided"),null;try{let b=(0,j.query)(k,(0,j.where)("archiveId","==",a)),c=await (0,j.getDocs)(b);if(c.empty)return console.log("ðŸ“­ Quiz Repository: No quiz found for archiveId",a),null;let d=l(c.docs[0]);return console.log("âœ… Quiz Repository: Quiz found",{quizId:d.id}),d}catch(a){return console.error("âŒ Quiz Repository: Query failed",a),null}}async function n(a){console.log("ðŸ’¾ Quiz Repository: Creating quiz",{archiveId:a.archiveId});let b={...a,createdAt:(0,j.serverTimestamp)()},c=await (0,j.addDoc)(k,b),d=l((await (0,j.getDocs)((0,j.query)(k,(0,j.where)("__name__","==",c.id)))).docs[0]);return console.log("âœ… Quiz Repository: Quiz created",{quizId:d.id}),d}async function o(a){try{let b=await fetch("/api/quiz/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!b.ok)return console.error("Quiz generation API failed:",b.status),null;return await b.json()}catch(a){return console.error("Quiz generation request failed:",a),null}}async function p(a,b,c,d,e,f,g){console.log("ðŸŽ¯ Quiz Service: getOrGenerateQuiz",{archiveId:a,title:b});let i=await m(a);if(i)return console.log("âœ… Quiz Service: Found existing quiz",{quizId:i.id}),h(i);console.log("ðŸ¤– Quiz Service: No quiz found, generating with Grok AI...");let j=await o({title:b,rootMeaning:c,examples:d,uiLocale:f,learningLanguage:g});if(!j)return console.error("âŒ Quiz Service: Quiz generation failed"),null;let k={archiveId:a,question:e,options:j.options,correctIndex:j.correctIndex,explanation:j.explanation},l=await n(k);return console.log("ðŸ’¾ Quiz Service: Quiz saved to Firebase",{quizId:l.id}),h(l)}var q=a.i(62444);function r(a,b,d){return(0,c.useQuery)({queryKey:["archives",a,b??"all",d?.sourceId??"all"],queryFn:()=>g(a,b,d?.sourceId),enabled:(d?.enabled??!0)&&!!a,staleTime:6e4,refetchOnMount:!0})}function s(a){let c=(0,d.useQueryClient)();return{create:(0,b.useMutation)({mutationFn:f,onSuccess:()=>c.invalidateQueries({queryKey:["archives",a]})})}}function t(a,b,c,d){let[e,f]=(0,q.useState)(null),[g,h]=(0,q.useState)(!1),[i,j]=(0,q.useState)(null);return(0,q.useEffect)(()=>{if(!a||!b){f(null),h(!1);return}let e=!1;return async function(){if(a&&b){h(!0),j(null);try{let g=await p(a.id,a.title,a.rootMeaning||a.title,a.examples||[],b,c||"en",d||"en");!e&&(f(g),g||j("Quiz generation failed"))}catch(a){e||(console.error("Quiz loading error:",a),j("Failed to load quiz"),f(null))}finally{e||h(!1)}}}(),()=>{e=!0}},[a?.id,b,c,d]),{quiz:e,isLoading:g,error:i}}a.s(["useArchiveList",()=>r,"useArchiveMutations",()=>s,"useQuiz",()=>t],16002)},80025,32564,a=>{"use strict";var b=a.i(71544),c=a.i(62444),d=a.i(83744);let e=c.forwardRef(({className:a,type:c,...e},f)=>(0,b.jsx)("input",{type:c,className:(0,d.cn)("flex h-10 w-full rounded-lg border border-white/10 bg-white/5 px-3 py-2 text-sm text-foreground placeholder:text-white/40 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary disabled:cursor-not-allowed disabled:opacity-50 backdrop-blur-sm transition-all hover:bg-white/10",a),ref:f,...e}));function f(a,b){}e.displayName="Input",a.s(["Input",()=>e],80025),a.s(["trackEvent",()=>f],32564)},90874,a=>{"use strict";var b=a.i(71544),c=a.i(62444),d=a.i(58081),e=a.i(70611),f=a.i(80025),g=a.i(5689),h=a.i(82969),i=a.i(16002),j=a.i(65638),k=a.i(98260),l=a.i(32564),m=a.i(64856),n=a.i(22172);function o(){let a=(0,h.useTranslations)("archive"),o=(0,h.useTranslations)("common"),p=(0,g.useLocale)(),{user:q,loading:r}=(0,j.useAuth)(),s=q?.uid??"",t=a("type_label",{defaultMessage:"Type"}),[u,v]=(0,c.useState)(void 0),[w,x]=(0,c.useState)("grammar"),[y,z]=(0,c.useState)(""),[A,B]=(0,c.useState)(""),[C,D]=(0,c.useState)(""),E=!!s&&!r,{data:F,isLoading:G}=(0,i.useArchiveList)(s,u,{enabled:E}),H=F??[];console.log("ðŸ“š Archive Page State:",{userId:s,loading:r,canLoad:E,isLoading:G,archivesCount:H.length,archives:H.slice(0,2)});let{create:I}=(0,i.useArchiveMutations)(s),[J,K]=(0,c.useState)(null),[L,M]=(0,c.useState)(null),[N,O]=(0,c.useState)(!1),{quiz:P,isLoading:Q,error:R}=(0,i.useQuiz)(J||void 0,J?a("quiz_question",{title:J.title}):void 0,p,p),S=(0,c.useMemo)(()=>u?H.filter(a=>a.type===u):H,[H,u]),T=async()=>{if(!y.trim())return void k.toast.error(a("title_required"));if(!s)return void k.toast.error(o("error"));try{await I.mutateAsync({userId:s,type:w,title:y.trim(),rootMeaning:A.trim(),examples:C?[C]:[]}),k.toast.success(o("success")),z(""),B(""),D("")}catch{k.toast.error(a("save_error"))}};return(0,b.jsx)(n.AuthGate,{children:(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold text-foreground",children:a("title")}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:a("subtitle")})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(e.Button,{variant:void 0===u?"primary":"ghost",onClick:()=>v(void 0),children:a("all")}),(0,b.jsx)(e.Button,{variant:"grammar"===u?"primary":"ghost",onClick:()=>v("grammar"),children:a("grammar")}),(0,b.jsx)(e.Button,{variant:"word"===u?"primary":"ghost",onClick:()=>v("word"),children:a("vocabulary")})]})]}),(0,b.jsxs)(d.Card,{className:"glass-card",children:[(0,b.jsx)(d.CardHeader,{children:(0,b.jsx)(d.CardTitle,{children:a("add_title")})}),(0,b.jsxs)(d.CardContent,{className:"grid gap-3 md:grid-cols-4",children:[(0,b.jsxs)("select",{"aria-label":t,className:"h-[42px] rounded-md border border-white/10 bg-white/5 px-3 text-sm",value:w,onChange:a=>x(a.target.value),children:[(0,b.jsx)("option",{value:"grammar",children:a("grammar")}),(0,b.jsx)("option",{value:"word",children:a("vocabulary")})]}),(0,b.jsx)(f.Input,{placeholder:a("title_placeholder"),value:y,onChange:a=>z(a.target.value)}),(0,b.jsx)(f.Input,{placeholder:a("root_placeholder"),value:A,onChange:a=>B(a.target.value)}),(0,b.jsx)(f.Input,{placeholder:a("example_placeholder"),value:C,onChange:a=>D(a.target.value)}),(0,b.jsx)(e.Button,{onClick:T,disabled:I.isPending,children:I.isPending?a("saving"):a("add_button")})]})]}),(0,b.jsxs)("div",{className:"grid gap-4 md:grid-cols-3",children:[(0,b.jsxs)(d.Card,{className:"md:col-span-2",children:[(0,b.jsx)(d.CardHeader,{children:(0,b.jsx)(d.CardTitle,{children:a("list_title")})}),(0,b.jsxs)(d.CardContent,{className:"space-y-3",children:[(r||G||!E)&&(0,b.jsx)("p",{className:"text-muted-foreground",children:o("loading")}),!r&&!G&&E&&0===S.length&&(0,b.jsx)("p",{className:"text-muted-foreground",children:a("empty")}),S.map(c=>(0,b.jsxs)("div",{className:"rounded-lg border border-white/10 bg-white/5 p-3 hover:border-primary/40 transition cursor-pointer",onClick:()=>{K(c),(0,l.trackEvent)("quiz_started",{archiveId:c.id,type:c.type})},children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("p",{className:"text-sm font-semibold text-foreground",children:c.title}),(0,b.jsx)("span",{className:"text-xs text-muted-foreground",children:"word"===c.type?a("vocabulary"):a("grammar")})]}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground line-clamp-2",children:c.rootMeaning}),(0,b.jsx)("p",{className:"text-[11px] text-muted-foreground mt-1",children:(0,m.formatDate)(c.createdAt,p)}),c.examples.length>0&&(0,b.jsx)("p",{className:"text-xs text-primary mt-1",children:c.examples[0]})]},c.id))]})]}),(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{children:(0,b.jsx)(d.CardTitle,{children:a("quiz_title")})}),(0,b.jsxs)(d.CardContent,{className:"space-y-3",children:[!P&&!Q&&J&&(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:a("quiz_empty")}),Q&&(0,b.jsx)("p",{className:"text-sm text-muted-foreground animate-pulse",children:"AI ìƒì„± ì¤‘..."}),R&&(0,b.jsx)("p",{className:"text-sm text-destructive",children:"í€´ì¦ˆ ìƒì„± ì‹¤íŒ¨"}),P&&(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("p",{className:"text-sm font-semibold text-foreground",children:P.question}),P.options.map((c,d)=>{let e=d===P.correctIndex,f=d===L;console.log(`Option ${d}:`,{isCorrect:e,isSelected:f,showResult:N,selectedAnswer:L});let g={},h="w-full text-left px-4 py-2 rounded-lg border transition-all text-sm ";return N?e?(g={backgroundColor:"rgba(34, 197, 94, 0.2)",borderColor:"rgb(34, 197, 94)",color:"rgb(220, 252, 231)"},h+="font-semibold"):f?g={backgroundColor:"rgba(239, 68, 68, 0.2)",borderColor:"rgb(239, 68, 68)",color:"rgb(254, 226, 226)"}:h+="opacity-30":h+="bg-card border-border hover:bg-accent hover:border-accent-foreground",(0,b.jsx)("button",{disabled:N,onClick:()=>{let b=d===P.correctIndex;console.log("ðŸŽ¯ Quiz answer clicked:",{idx:d,correct:b,beforeState:{selectedAnswer:L,showResult:N}}),M(d),O(!0),console.log("âœ… State updated:",{newSelectedAnswer:d,newShowResult:!0}),(0,l.trackEvent)("quiz_answered",{archiveId:P.archiveId,selected:d,correct:b}),k.toast[b?"success":"error"](b?a("quiz_correct"):a("quiz_wrong"),{description:P.explanation}),setTimeout(()=>{console.log("ðŸ”„ Resetting quiz state"),M(null),O(!1)},7e3)},className:h,style:g,children:c},d)}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-2",children:P.explanation})]})]})]})]})]})})}a.s(["default",()=>o])}];

//# sourceMappingURL=Development_Loglingo_src_b008ce2e._.js.map