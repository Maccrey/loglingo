module.exports=[12834,a=>{"use strict";var b=a.i(903);a.i(91105);var c=a.i(93019);let d=(0,c.collection)(b.db,"learning_archive");function e(a){let b=a.data(),d=b.createdAt instanceof c.Timestamp?b.createdAt.toDate():new Date(b.createdAt??Date.now());return{id:a.id,userId:b.userId,type:b.type,title:b.title,examples:b.examples||[],rootMeaning:b.rootMeaning||"",sourceId:b.sourceId,createdAt:d}}async function f(a,b,f){if(console.log("ðŸ” Archive Repository: listArchive called",{userId:a,type:b,sourceId:f}),!a)return console.log("âš ï¸ Archive Repository: No userId, returning empty array"),[];try{let g=[(0,c.where)("userId","==",a)];b&&g.push((0,c.where)("type","==",b)),f&&g.push((0,c.where)("sourceId","==",f));let h=(0,c.query)(d,...g);console.log("ðŸ” Archive Repository: Executing query...");let i=(await (0,c.getDocs)(h)).docs.map(e);return i.sort((a,b)=>b.createdAt.getTime()-a.createdAt.getTime()),console.log("âœ… Archive Repository: Query complete",{count:i.length,results:i.slice(0,2)}),i}catch(a){throw console.error("âŒ Archive Repository: Query failed",a),a}}async function g(a,b){if(console.log("ðŸ” Archive Repository: checkDuplicate",{userId:a,title:b}),!a||!b)return!1;try{let e=(0,c.query)(d,(0,c.where)("userId","==",a),(0,c.where)("title","==",b)),f=!(await (0,c.getDocs)(e)).empty;return console.log(f?"âš ï¸ Archive Repository: Duplicate found":"âœ… Archive Repository: No duplicate"),f}catch(a){return console.error("âŒ Archive Repository: Check duplicate failed",a),!1}}async function h(a){let b={...a,createdAt:(0,c.serverTimestamp)()},f=await (0,c.addDoc)(d,b);return(await (0,c.getDocs)((0,c.query)(d,(0,c.where)("__name__","==",f.id)))).docs.map(e)[0]}a.s(["checkDuplicate",()=>g,"createArchive",()=>h,"listArchive",()=>f])},16002,a=>{"use strict";var b=a.i(93051),c=a.i(61738),d=a.i(81473),e=a.i(12834);async function f(a){if(!a.title.trim())throw Error("title-required");return(0,e.createArchive)({...a,examples:a.examples?.filter(Boolean)??[],rootMeaning:a.rootMeaning??""})}async function g(a,b,c){return(0,e.listArchive)(a,b,c)}function h(a){let b=a.options.map((a,b)=>({option:a,index:b})).sort(()=>Math.random()-.5),c=b.findIndex(b=>b.index===a.correctIndex);return{...a,options:b.map(a=>a.option),correctIndex:c}}var i=a.i(903);a.i(91105);var j=a.i(93019);let k=(0,j.collection)(i.db,"quizzes");function l(a){let b=a.data(),c=b.createdAt instanceof j.Timestamp?b.createdAt.toDate():new Date(b.createdAt??Date.now());return{id:a.id,archiveId:b.archiveId,question:b.question,options:b.options||[],correctIndex:b.correctIndex??0,explanation:b.explanation||"",createdAt:c}}async function m(a){if(console.log("ðŸ” Quiz Repository: getQuizByArchiveId called",{archiveId:a}),!a)return console.log("âš ï¸ Quiz Repository: No archiveId provided"),null;try{let b=(0,j.query)(k,(0,j.where)("archiveId","==",a)),c=await (0,j.getDocs)(b);if(c.empty)return console.log("ðŸ“­ Quiz Repository: No quiz found for archiveId",a),null;let d=l(c.docs[0]);return console.log("âœ… Quiz Repository: Quiz found",{quizId:d.id}),d}catch(a){return console.error("âŒ Quiz Repository: Query failed",a),null}}async function n(a){console.log("ðŸ’¾ Quiz Repository: Creating quiz",{archiveId:a.archiveId});let b={...a,createdAt:(0,j.serverTimestamp)()},c=await (0,j.addDoc)(k,b),d=l((await (0,j.getDocs)((0,j.query)(k,(0,j.where)("__name__","==",c.id)))).docs[0]);return console.log("âœ… Quiz Repository: Quiz created",{quizId:d.id}),d}async function o(a){try{let b=await fetch("/api/quiz/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!b.ok)return console.error("Quiz generation API failed:",b.status),null;return await b.json()}catch(a){return console.error("Quiz generation request failed:",a),null}}async function p(a,b,c,d,e,f,g){console.log("ðŸŽ¯ Quiz Service: getOrGenerateQuiz",{archiveId:a,title:b});let i=await m(a);if(i)return console.log("âœ… Quiz Service: Found existing quiz",{quizId:i.id}),h(i);console.log("ðŸ¤– Quiz Service: No quiz found, generating with Grok AI...");let j=await o({title:b,rootMeaning:c,examples:d,uiLocale:f,learningLanguage:g});if(!j)return console.error("âŒ Quiz Service: Quiz generation failed"),null;let k={archiveId:a,question:e,options:j.options,correctIndex:j.correctIndex,explanation:j.explanation},l=await n(k);return console.log("ðŸ’¾ Quiz Service: Quiz saved to Firebase",{quizId:l.id}),h(l)}var q=a.i(62444);function r(a,b,d){return(0,c.useQuery)({queryKey:["archives",a,b??"all",d?.sourceId??"all"],queryFn:()=>g(a,b,d?.sourceId),enabled:(d?.enabled??!0)&&!!a,staleTime:6e4,refetchOnMount:!0})}function s(a){let c=(0,d.useQueryClient)();return{create:(0,b.useMutation)({mutationFn:f,onSuccess:()=>c.invalidateQueries({queryKey:["archives",a]})})}}function t(a,b,c,d){let[e,f]=(0,q.useState)(null),[g,h]=(0,q.useState)(!1),[i,j]=(0,q.useState)(null);return(0,q.useEffect)(()=>{if(!a||!b){f(null),h(!1);return}let e=!1;return async function(){if(a&&b){h(!0),j(null);try{let g=await p(a.id,a.title,a.rootMeaning||a.title,a.examples||[],b,c||"en",d||"en");!e&&(f(g),g||j("Quiz generation failed"))}catch(a){e||(console.error("Quiz loading error:",a),j("Failed to load quiz"),f(null))}finally{e||h(!1)}}}(),()=>{e=!0}},[a?.id,b,c,d]),{quiz:e,isLoading:g,error:i}}a.s(["useArchiveList",()=>r,"useArchiveMutations",()=>s,"useQuiz",()=>t],16002)},14476,a=>{"use strict";function b(){return"demo-user"}a.i(903),a.s(["getCurrentUserId",()=>b])},38790,a=>{"use strict";let b=(0,a.i(16195).default)("archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]);a.s(["Archive",()=>b],38790)},64856,a=>{"use strict";function b(a,b){let c="string"==typeof a?new Date(`${a}T00:00:00`):a;return new Intl.DateTimeFormat(b,{year:"numeric",month:"short",day:"numeric"}).format(c)}a.s(["formatDate",()=>b])},28492,a=>{"use strict";let b=(0,a.i(16195).default)("pen-line",[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);a.s(["Edit3",()=>b],28492)},85925,a=>{"use strict";var b=a.i(71544),c=a.i(62444),d=a.i(80657),e=a.i(16002),f=a.i(14476),g=a.i(58081),h=a.i(82969),i=a.i(22172),j=a.i(82734),k=a.i(38790),l=a.i(28163),m=a.i(28492);let n=(0,a.i(16195).default)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);var o=a.i(70611),p=a.i(8593),q=a.i(64856),r=a.i(5689);function s({params:a}){let{id:s}=(0,c.use)(a),t=(0,f.getCurrentUserId)(),u=(0,h.useTranslations)("diary"),v=(0,h.useTranslations)("archive"),w=(0,r.useLocale)(),x=(0,j.useRouter)(),{data:y,isLoading:z}=(0,d.useDiaryDetail)(t,s),{data:A=[],isLoading:B}=(0,e.useArchiveList)(t,void 0,{sourceId:s});return z?(0,b.jsx)(i.AuthGate,{children:(0,b.jsxs)(g.Card,{className:"max-w-3xl mx-auto",children:[(0,b.jsx)(g.CardHeader,{children:(0,b.jsx)(g.CardTitle,{children:u("loading")})}),(0,b.jsx)(g.CardContent,{children:(0,b.jsx)("div",{className:"h-32 animate-pulse rounded-lg bg-white/5"})})]})}):y?(0,b.jsx)(i.AuthGate,{children:(0,b.jsxs)("div",{className:"mx-auto max-w-3xl space-y-6",children:[(0,b.jsxs)(g.Card,{children:[(0,b.jsxs)(g.CardHeader,{children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)(o.Button,{variant:"ghost",size:"sm",onClick:()=>x.push("/diary"),children:[(0,b.jsx)(n,{className:"mr-2 h-4 w-4"}),u("back")]}),(0,b.jsxs)(o.Button,{variant:"secondary",size:"sm",onClick:()=>x.push(`/diary/${s}/edit`),children:[(0,b.jsx)(m.Edit3,{className:"mr-2 h-4 w-4"}),u("edit")]})]}),(0,b.jsx)(g.CardTitle,{className:"text-2xl mt-4",children:(0,q.formatDate)(new Date(`${y.date}T00:00:00`),w)})]}),(0,b.jsxs)(g.CardContent,{className:"space-y-4",children:[y.imageUrl&&(0,b.jsx)(p.default,{src:y.imageUrl,alt:"Diary image",width:1200,height:800,className:"w-full rounded-lg object-cover",loading:"lazy"}),(0,b.jsx)("p",{className:"whitespace-pre-wrap text-foreground leading-relaxed",children:y.content})]})]}),(0,b.jsxs)(g.Card,{children:[(0,b.jsx)(g.CardHeader,{children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(k.Archive,{className:"h-5 w-5 text-primary"}),(0,b.jsx)(g.CardTitle,{children:v("title")})]})}),(0,b.jsx)(g.CardContent,{children:B?(0,b.jsx)("div",{className:"h-20 animate-pulse rounded-lg bg-white/5"}):A.length>0?(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground mb-3",children:"ì´ ì¼ê¸°ì—ì„œ ì €ìž¥ëœ í•™ìŠµ í•­ëª©ë“¤"}),(0,b.jsx)("div",{className:"max-h-60 overflow-y-auto space-y-2 pr-1 custom-scrollbar",children:A.map(a=>(0,b.jsx)("div",{className:"rounded-lg border border-white/10 bg-white/5 p-3 hover:bg-white/10 transition-colors cursor-pointer",onClick:()=>x.push("/archive"),children:(0,b.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("p",{className:"text-sm font-medium text-foreground",children:a.title}),a.rootMeaning&&(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:a.rootMeaning})]}),(0,b.jsx)("span",{className:"text-xs px-2 py-1 rounded-full bg-primary/10 text-primary",children:"grammar"===a.type?"ë¬¸ë²•":"ë‹¨ì–´"})]})},a.id))})]}):(0,b.jsxs)("div",{className:"text-center py-6",children:[(0,b.jsx)(l.Sparkles,{className:"h-8 w-8 text-muted-foreground mx-auto mb-2"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"ì•„ì§ ì €ìž¥ëœ í•™ìŠµ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"AI êµì •ì„ ì‚¬ìš©í•˜ë©´ ìžë™ìœ¼ë¡œ ì €ìž¥ë©ë‹ˆë‹¤"})]})})]})]})}):(0,b.jsx)(i.AuthGate,{children:(0,b.jsxs)(g.Card,{className:"max-w-3xl mx-auto",children:[(0,b.jsx)(g.CardHeader,{children:(0,b.jsx)(g.CardTitle,{children:u("not_found")})}),(0,b.jsx)(g.CardContent,{children:(0,b.jsx)("p",{className:"text-muted-foreground",children:u("not_found_desc")})})]})})}a.s(["default",()=>s],85925)}];

//# sourceMappingURL=Development_Loglingo_a2de62bf._.js.map