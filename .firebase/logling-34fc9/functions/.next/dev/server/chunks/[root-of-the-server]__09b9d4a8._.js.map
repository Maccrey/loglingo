{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/maccrey/Development/Loglingo/src/infrastructure/api/grok.ts"],"sourcesContent":["interface GrokCompletionRequest {\n  messages: { role: \"system\" | \"user\" | \"assistant\"; content: string }[];\n  model?: string;\n  temperature?: number;\n  signal?: AbortSignal;\n  response_format?: Record<string, unknown>;\n}\n\ninterface GrokCompletionResponse {\n  choices: { message: { content: string } }[];\n}\n\nexport class GrokClient {\n  private apiKey: string;\n  // Allow overriding via env; default to x.ai endpoint\n  private baseUrl: string;\n\n  constructor(apiKey: string, baseUrl?: string) {\n    this.apiKey = apiKey;\n    this.baseUrl = baseUrl || \"https://api.x.ai/v1/chat/completions\";\n  }\n\n  async chatCompletion(request: GrokCompletionRequest): Promise<string> {\n    try {\n      const response = await fetch(this.baseUrl, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          \"Authorization\": `Bearer ${this.apiKey}`,\n        },\n        body: JSON.stringify({\n          model: request.model || \"grok-1\", // Default model\n          temperature: request.temperature || 0.7,\n          messages: request.messages,\n          response_format: request.response_format,\n        }),\n        signal: request.signal,\n      });\n\n      if (!response.ok) {\n        const errorText = await response.text();\n        throw new Error(`Grok API Error: ${response.status} ${response.statusText} - ${errorText}`);\n      }\n\n      const data: GrokCompletionResponse = await response.json();\n      return data.choices[0].message.content;\n    } catch (error) {\n      console.error(\"Grok API Request Failed:\", error);\n      throw error;\n    }\n  }\n}\n\n// Singleton instance for server-side usage\nexport const grokClient = new GrokClient(process.env.GROK_API_KEY || \"\");\n"],"names":[],"mappings":";;;;;;AAYO,MAAM;IACH,OAAe;IACvB,qDAAqD;IAC7C,QAAgB;IAExB,YAAY,MAAc,EAAE,OAAgB,CAAE;QAC5C,IAAI,CAAC,MAAM,GAAG;QACd,IAAI,CAAC,OAAO,GAAG,WAAW;IAC5B;IAEA,MAAM,eAAe,OAA8B,EAAmB;QACpE,IAAI;YACF,MAAM,WAAW,MAAM,MAAM,IAAI,CAAC,OAAO,EAAE;gBACzC,QAAQ;gBACR,SAAS;oBACP,gBAAgB;oBAChB,iBAAiB,CAAC,OAAO,EAAE,IAAI,CAAC,MAAM,EAAE;gBAC1C;gBACA,MAAM,KAAK,SAAS,CAAC;oBACnB,OAAO,QAAQ,KAAK,IAAI;oBACxB,aAAa,QAAQ,WAAW,IAAI;oBACpC,UAAU,QAAQ,QAAQ;oBAC1B,iBAAiB,QAAQ,eAAe;gBAC1C;gBACA,QAAQ,QAAQ,MAAM;YACxB;YAEA,IAAI,CAAC,SAAS,EAAE,EAAE;gBAChB,MAAM,YAAY,MAAM,SAAS,IAAI;gBACrC,MAAM,IAAI,MAAM,CAAC,gBAAgB,EAAE,SAAS,MAAM,CAAC,CAAC,EAAE,SAAS,UAAU,CAAC,GAAG,EAAE,WAAW;YAC5F;YAEA,MAAM,OAA+B,MAAM,SAAS,IAAI;YACxD,OAAO,KAAK,OAAO,CAAC,EAAE,CAAC,OAAO,CAAC,OAAO;QACxC,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,4BAA4B;YAC1C,MAAM;QACR;IACF;AACF;AAGO,MAAM,aAAa,IAAI,WAAW,QAAQ,GAAG,CAAC,YAAY,IAAI"}},
    {"offset": {"line": 93, "column": 0}, "map": {"version":3,"sources":["file:///Users/maccrey/Development/Loglingo/src/app/api/quiz/generate/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport { GrokClient } from \"@/infrastructure/api/grok\";\n\nconst TIMEOUT_MS = 15000;\n\nfunction getModel() {\n  return process.env.GROK_MODEL?.trim() || \"grok-2-1212\";\n}\n\ninterface QuizGenerationRequest {\n  title: string;\n  rootMeaning: string;\n  examples: string[];\n  uiLocale: string;\n  learningLanguage: string;\n}\n\ninterface QuizGenerationResponse {\n  options: string[];\n  correctIndex: number;\n  explanation: string;\n}\n\nfunction buildPrompt(\n  title: string,\n  rootMeaning: string,\n  examples: string[],\n  uiLocale: string,\n  learningLanguage: string\n): string {\n  return `You are a language learning quiz generator.\n\nCreate a multiple-choice quiz for this language learning item:\n- Title/Pattern: \"${title}\" (in ${learningLanguage})\n- Root Meaning: \"${rootMeaning}\"\n- Examples: ${examples.join(\", \")}\n\nIMPORTANT: Generate all quiz options in the learner's native language (${uiLocale}), NOT in ${learningLanguage}.\nThis helps learners better understand and think about the meaning.\n\nGenerate 4 answer options:\n1. The correct answer (translate or explain the root meaning in ${uiLocale})\n2-4. Plausible but incorrect alternatives in ${uiLocale}, related to the topic but clearly wrong\n\nProvide a brief explanation in ${uiLocale} (the user's native language).\n\nRespond with ONLY valid JSON using this exact structure:\n{\n  \"options\": [\"correct answer in ${uiLocale}\", \"wrong option 1 in ${uiLocale}\", \"wrong option 2 in ${uiLocale}\", \"wrong option 3 in ${uiLocale}\"],\n  \"correctIndex\": 0,\n  \"explanation\": \"brief explanation in ${uiLocale}\"\n}\n\nDo not add code fences, commentary, or any text outside the JSON.`\n;\n}\n\nasync function getClient() {\n  const key = process.env.GROK_API_KEY;\n  if (!key) return null;\n  return new GrokClient(key, process.env.GROK_BASE_URL);\n}\n\nasync function callGrok(\n  title: string,\n  rootMeaning: string,\n  examples: string[],\n  uiLocale: string,\n  learningLanguage: string\n): Promise<QuizGenerationResponse | null> {\n  const client = await getClient();\n  if (!client) {\n    console.error(\"Grok client unavailable: missing GROK_API_KEY\");\n    return null;\n  }\n\n  const controller = new AbortController();\n  const timer = setTimeout(() => controller.abort(), TIMEOUT_MS);\n\n  try {\n    const response = await client.chatCompletion({\n      messages: [\n        {\n          role: \"system\",\n          content: \"You are a helpful language learning quiz generator. Always respond with valid JSON only.\",\n        },\n        {\n          role: \"user\",\n          content: buildPrompt(title, rootMeaning, examples, uiLocale, learningLanguage),\n        },\n      ],\n      model: getModel(),\n      temperature: 0.7,\n      signal: controller.signal,\n      response_format: {\n        type: \"json_schema\",\n        json_schema: {\n          name: \"QuizGeneration\",\n          schema: {\n            type: \"object\",\n            properties: {\n              options: {\n                type: \"array\",\n                items: { type: \"string\" },\n                minItems: 4,\n                maxItems: 4,\n              },\n              correctIndex: {\n                type: \"number\",\n                minimum: 0,\n                maximum: 3,\n              },\n              explanation: { type: \"string\" },\n            },\n            required: [\"options\", \"correctIndex\", \"explanation\"],\n            additionalProperties: false,\n          },\n          strict: true,\n        },\n      },\n    });\n\n    try {\n      return JSON.parse(response) as QuizGenerationResponse;\n    } catch (error) {\n      console.error(\"Failed to parse Grok quiz response:\", error, response);\n      return null;\n    }\n  } catch (error) {\n    console.error(\"Grok quiz generation failed:\", error);\n    return null;\n  } finally {\n    clearTimeout(timer);\n  }\n}\n\nexport async function POST(req: Request) {\n  try {\n    const body: QuizGenerationRequest = await req.json();\n    const { title, rootMeaning, examples, uiLocale, learningLanguage } = body;\n\n    if (!title || !rootMeaning) {\n      return NextResponse.json(\n        { message: \"title and rootMeaning required\" },\n        { status: 400 }\n      );\n    }\n\n    const result = await callGrok(\n      title,\n      rootMeaning,\n      examples || [],\n      uiLocale || \"en\",\n      learningLanguage || \"en\"\n    );\n\n    if (!result) {\n      return NextResponse.json(\n        { message: \"Quiz generation failed\" },\n        { status: 500 }\n      );\n    }\n\n    return NextResponse.json(result);\n  } catch (error) {\n    console.error(\"Quiz generation API error:\", error);\n    return NextResponse.json(\n      { message: \"Quiz generation failed\" },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":"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"}}]
}