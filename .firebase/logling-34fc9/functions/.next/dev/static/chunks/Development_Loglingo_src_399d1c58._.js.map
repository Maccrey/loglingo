{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/maccrey/Development/Loglingo/src/lib/utils.ts"],"sourcesContent":["import { type ClassValue, clsx } from \"clsx\";\nimport { twMerge } from \"tailwind-merge\";\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs));\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,SAAS,GAAG,GAAG,MAAoB;IACxC,OAAO,IAAA,oMAAO,EAAC,IAAA,2KAAI,EAAC;AACtB"}},
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":["file:///Users/maccrey/Development/Loglingo/src/components/ui/Button.tsx"],"sourcesContent":["import * as React from \"react\";\nimport { cn } from \"@/lib/utils\";\nimport { Loader2 } from \"lucide-react\";\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement> {\n  variant?: \"primary\" | \"secondary\" | \"ghost\" | \"glass\" | \"destructive\";\n  size?: \"sm\" | \"md\" | \"lg\" | \"icon\";\n  isLoading?: boolean;\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant = \"primary\", size = \"md\", isLoading, children, ...props }, ref) => {\n    const variants = {\n      primary: \"bg-primary text-primary-foreground hover:bg-primary/90 shadow-md\",\n      secondary: \"bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n      ghost: \"hover:bg-white/10 text-foreground\",\n      glass: \"glass hover:bg-white/10 text-foreground active:scale-95 transition-transform\",\n      destructive: \"bg-red-500 text-white hover:bg-red-600\",\n    };\n\n    const sizes = {\n      sm: \"h-8 px-3 text-xs\",\n      md: \"h-10 px-4 py-2\",\n      lg: \"h-12 px-8 text-lg\",\n      icon: \"h-10 w-10 p-2 flex items-center justify-center\",\n    };\n\n    return (\n      <button\n        className={cn(\n          \"inline-flex items-center justify-center rounded-lg font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary disabled:pointer-events-none disabled:opacity-50\",\n          variants[variant],\n          sizes[size],\n          className\n        )}\n        ref={ref}\n        disabled={isLoading || props.disabled}\n        {...props}\n      >\n        {isLoading && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\n        {children}\n      </button>\n    );\n  }\n);\nButton.displayName = \"Button\";\n\nexport { Button };\n"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;;;;;AASA,MAAM,uBAAS,sMAAgB,MAC7B,CAAC,EAAE,SAAS,EAAE,UAAU,SAAS,EAAE,OAAO,IAAI,EAAE,SAAS,EAAE,QAAQ,EAAE,GAAG,OAAO,EAAE;IAC/E,MAAM,WAAW;QACf,SAAS;QACT,WAAW;QACX,OAAO;QACP,OAAO;QACP,aAAa;IACf;IAEA,MAAM,QAAQ;QACZ,IAAI;QACJ,IAAI;QACJ,IAAI;QACJ,MAAM;IACR;IAEA,qBACE,wNAAC;QACC,WAAW,IAAA,uJAAE,EACX,gNACA,QAAQ,CAAC,QAAQ,EACjB,KAAK,CAAC,KAAK,EACX;QAEF,KAAK;QACL,UAAU,aAAa,MAAM,QAAQ;QACpC,GAAG,KAAK;;YAER,2BAAa,wNAAC,0PAAO;gBAAC,WAAU;;;;;;YAChC;;;;;;;AAGP;;AAEF,OAAO,WAAW,GAAG"}},
    {"offset": {"line": 82, "column": 0}, "map": {"version":3,"sources":["file:///Users/maccrey/Development/Loglingo/src/components/ui/Input.tsx"],"sourcesContent":["import * as React from \"react\";\nimport { cn } from \"@/lib/utils\";\n\n// InputProps is equivalent to React.InputHTMLAttributes<HTMLInputElement>\nexport type InputProps = React.InputHTMLAttributes<HTMLInputElement>;\n\nconst Input = React.forwardRef<HTMLInputElement, InputProps>(\n  ({ className, type, ...props }, ref) => {\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-10 w-full rounded-lg border border-white/10 bg-white/5 px-3 py-2 text-sm text-foreground placeholder:text-white/40 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary disabled:cursor-not-allowed disabled:opacity-50 backdrop-blur-sm transition-all hover:bg-white/10\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    );\n  }\n);\nInput.displayName = \"Input\";\n\nexport { Input };\n"],"names":[],"mappings":";;;;;AAAA;AACA;;;;AAKA,MAAM,sBAAQ,sMAAgB,MAC5B,CAAC,EAAE,SAAS,EAAE,IAAI,EAAE,GAAG,OAAO,EAAE;IAC9B,qBACE,wNAAC;QACC,MAAM;QACN,WAAW,IAAA,uJAAE,EACX,0SACA;QAEF,KAAK;QACJ,GAAG,KAAK;;;;;;AAGf;;AAEF,MAAM,WAAW,GAAG"}},
    {"offset": {"line": 117, "column": 0}, "map": {"version":3,"sources":["file:///Users/maccrey/Development/Loglingo/src/components/ui/Card.tsx"],"sourcesContent":["import * as React from \"react\";\nimport { cn } from \"@/lib/utils\";\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"glass-card bg-white/5 text-card-foreground p-6\",\n      className\n    )}\n    {...props}\n  />\n));\nCard.displayName = \"Card\";\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 pb-4\", className)}\n    {...props}\n  />\n));\nCardHeader.displayName = \"CardHeader\";\n\nconst CardTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h3\n    ref={ref}\n    className={cn(\"font-semibold leading-none tracking-tight text-lg\", className)}\n    {...props}\n  />\n));\nCardTitle.displayName = \"CardTitle\";\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"pt-0\", className)} {...props} />\n));\nCardContent.displayName = \"CardContent\";\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center pt-4\", className)}\n    {...props}\n  />\n));\nCardFooter.displayName = \"CardFooter\";\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardContent };\n"],"names":[],"mappings":";;;;;;;;;;;;;AAAA;AACA;;;;AAEA,MAAM,qBAAO,sMAAgB,MAG3B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,wNAAC;QACC,KAAK;QACL,WAAW,IAAA,uJAAE,EACX,kDACA;QAED,GAAG,KAAK;;;;;;;AAGb,KAAK,WAAW,GAAG;AAEnB,MAAM,2BAAa,sMAAgB,OAGjC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,wNAAC;QACC,KAAK;QACL,WAAW,IAAA,uJAAE,EAAC,kCAAkC;QAC/C,GAAG,KAAK;;;;;;;AAGb,WAAW,WAAW,GAAG;AAEzB,MAAM,0BAAY,sMAAgB,OAGhC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,wNAAC;QACC,KAAK;QACL,WAAW,IAAA,uJAAE,EAAC,qDAAqD;QAClE,GAAG,KAAK;;;;;;;AAGb,UAAU,WAAW,GAAG;AAExB,MAAM,4BAAc,sMAAgB,OAGlC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,wNAAC;QAAI,KAAK;QAAK,WAAW,IAAA,uJAAE,EAAC,QAAQ;QAAa,GAAG,KAAK;;;;;;;AAE5D,YAAY,WAAW,GAAG;AAE1B,MAAM,2BAAa,sMAAgB,OAGjC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,wNAAC;QACC,KAAK;QACL,WAAW,IAAA,uJAAE,EAAC,0BAA0B;QACvC,GAAG,KAAK;;;;;;;AAGb,WAAW,WAAW,GAAG"}},
    {"offset": {"line": 209, "column": 0}, "map": {"version":3,"sources":["file:///Users/maccrey/Development/Loglingo/src/domain/diary.ts"],"sourcesContent":["export interface Diary {\n  id: string;\n  userId: string;\n  date: string; // yyyy-mm-dd\n  content: string;\n  imageUrl?: string;\n  aiReviewed: boolean;\n  createdAt: Date;\n  updatedAt?: Date;\n}\n\nexport interface DiaryDraft {\n  userId: string;\n  date: string;\n  content: string;\n  imageUrl?: string;\n  aiReviewed?: boolean;\n}\n\nexport interface DiaryImageUploadResult {\n  url: string;\n  path: string;\n}\n\nexport interface DiaryRepository {\n  listByUser(userId: string, year?: number): Promise<Diary[]>;\n  getById(userId: string, id: string): Promise<Diary | null>;\n  create(input: DiaryDraft): Promise<Diary>;\n  update(id: string, input: Partial<DiaryDraft>): Promise<Diary>;\n  delete(id: string): Promise<void>;\n}\n\nexport function validateDiaryInput(input: Pick<DiaryDraft, \"date\" | \"content\">) {\n  const errors: string[] = [];\n\n  if (!/^\\d{4}-\\d{2}-\\d{2}$/.test(input.date)) {\n    errors.push(\"invalid-date\");\n  }\n\n  const trimmed = input.content.trim();\n  if (!trimmed) {\n    errors.push(\"empty-content\");\n  }\n\n  if (trimmed.length > 5000) {\n    errors.push(\"too-long\");\n  }\n\n  return { valid: errors.length === 0, errors };\n}\n"],"names":[],"mappings":";;;;AAgCO,SAAS,mBAAmB,KAA2C;IAC5E,MAAM,SAAmB,EAAE;IAE3B,IAAI,CAAC,sBAAsB,IAAI,CAAC,MAAM,IAAI,GAAG;QAC3C,OAAO,IAAI,CAAC;IACd;IAEA,MAAM,UAAU,MAAM,OAAO,CAAC,IAAI;IAClC,IAAI,CAAC,SAAS;QACZ,OAAO,IAAI,CAAC;IACd;IAEA,IAAI,QAAQ,MAAM,GAAG,MAAM;QACzB,OAAO,IAAI,CAAC;IACd;IAEA,OAAO;QAAE,OAAO,OAAO,MAAM,KAAK;QAAG;IAAO;AAC9C"}},
    {"offset": {"line": 237, "column": 0}, "map": {"version":3,"sources":["file:///Users/maccrey/Development/Loglingo/src/lib/image.ts"],"sourcesContent":["\"use client\";\n\nconst MAX_DIMENSION = 1600;\nconst MAX_SIZE_BYTES = 300 * 1024;\n\nexport interface ImageConversionResult {\n  file: File;\n  previewUrl: string;\n}\n\nexport async function convertImageToWebP(file: File): Promise<ImageConversionResult> {\n  if (typeof window === \"undefined\") {\n    throw new Error(\"Image conversion is only available in the browser.\");\n  }\n\n  const image = await loadImage(file);\n  const canvas = document.createElement(\"canvas\");\n  const context = canvas.getContext(\"2d\");\n\n  if (!context) {\n    throw new Error(\"Failed to acquire 2D context for image conversion.\");\n  }\n\n  const scale = Math.min(1, MAX_DIMENSION / Math.max(image.width, image.height));\n  canvas.width = Math.max(1, Math.round(image.width * scale));\n  canvas.height = Math.max(1, Math.round(image.height * scale));\n\n  context.drawImage(image, 0, 0, canvas.width, canvas.height);\n\n  let quality = 0.9;\n  let blob = await toWebPBlob(canvas, quality);\n\n  while (blob && blob.size > MAX_SIZE_BYTES && quality > 0.4) {\n    quality -= 0.1;\n    blob = await toWebPBlob(canvas, quality);\n  }\n\n  if (blob && blob.size > MAX_SIZE_BYTES) {\n    blob = await toWebPBlob(canvas, 0.3);\n  }\n\n  if (!blob) {\n    throw new Error(\"Failed to generate image blob.\");\n  }\n\n  const optimizedFile = new File([blob], replaceExtension(file.name, \"webp\"), {\n    type: \"image/webp\",\n  });\n\n  return {\n    file: optimizedFile,\n    previewUrl: canvas.toDataURL(\"image/webp\", 0.8),\n  };\n}\n\nexport function getImagePreview(file: File): Promise<string> {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.onload = () => resolve(reader.result as string);\n    reader.onerror = () => reject(new Error(\"Failed to read image preview\"));\n    reader.readAsDataURL(file);\n  });\n}\n\nasync function loadImage(file: File): Promise<HTMLImageElement> {\n  const src = await getImagePreview(file);\n  return new Promise((resolve, reject) => {\n    const img = new Image();\n    img.onload = () => resolve(img);\n    img.onerror = () => reject(new Error(\"Failed to load image\"));\n    img.src = src;\n  });\n}\n\nfunction replaceExtension(name: string, ext: string) {\n  const base = name.includes(\".\") ? name.substring(0, name.lastIndexOf(\".\")) : name;\n  return `${base}.${ext}`;\n}\n\nfunction toWebPBlob(canvas: HTMLCanvasElement, quality: number): Promise<Blob | null> {\n  return new Promise((resolve) => {\n    canvas.toBlob(\n      (blob) => resolve(blob),\n      \"image/webp\",\n      Math.max(0.2, Math.min(1, quality))\n    );\n  });\n}\n"],"names":[],"mappings":";;;;;;AAAA;AAEA,MAAM,gBAAgB;AACtB,MAAM,iBAAiB,MAAM;AAOtB,eAAe,mBAAmB,IAAU;IACjD;;IAIA,MAAM,QAAQ,MAAM,UAAU;IAC9B,MAAM,SAAS,SAAS,aAAa,CAAC;IACtC,MAAM,UAAU,OAAO,UAAU,CAAC;IAElC,IAAI,CAAC,SAAS;QACZ,MAAM,IAAI,MAAM;IAClB;IAEA,MAAM,QAAQ,KAAK,GAAG,CAAC,GAAG,gBAAgB,KAAK,GAAG,CAAC,MAAM,KAAK,EAAE,MAAM,MAAM;IAC5E,OAAO,KAAK,GAAG,KAAK,GAAG,CAAC,GAAG,KAAK,KAAK,CAAC,MAAM,KAAK,GAAG;IACpD,OAAO,MAAM,GAAG,KAAK,GAAG,CAAC,GAAG,KAAK,KAAK,CAAC,MAAM,MAAM,GAAG;IAEtD,QAAQ,SAAS,CAAC,OAAO,GAAG,GAAG,OAAO,KAAK,EAAE,OAAO,MAAM;IAE1D,IAAI,UAAU;IACd,IAAI,OAAO,MAAM,WAAW,QAAQ;IAEpC,MAAO,QAAQ,KAAK,IAAI,GAAG,kBAAkB,UAAU,IAAK;QAC1D,WAAW;QACX,OAAO,MAAM,WAAW,QAAQ;IAClC;IAEA,IAAI,QAAQ,KAAK,IAAI,GAAG,gBAAgB;QACtC,OAAO,MAAM,WAAW,QAAQ;IAClC;IAEA,IAAI,CAAC,MAAM;QACT,MAAM,IAAI,MAAM;IAClB;IAEA,MAAM,gBAAgB,IAAI,KAAK;QAAC;KAAK,EAAE,iBAAiB,KAAK,IAAI,EAAE,SAAS;QAC1E,MAAM;IACR;IAEA,OAAO;QACL,MAAM;QACN,YAAY,OAAO,SAAS,CAAC,cAAc;IAC7C;AACF;AAEO,SAAS,gBAAgB,IAAU;IACxC,OAAO,IAAI,QAAQ,CAAC,SAAS;QAC3B,MAAM,SAAS,IAAI;QACnB,OAAO,MAAM,GAAG,IAAM,QAAQ,OAAO,MAAM;QAC3C,OAAO,OAAO,GAAG,IAAM,OAAO,IAAI,MAAM;QACxC,OAAO,aAAa,CAAC;IACvB;AACF;AAEA,eAAe,UAAU,IAAU;IACjC,MAAM,MAAM,MAAM,gBAAgB;IAClC,OAAO,IAAI,QAAQ,CAAC,SAAS;QAC3B,MAAM,MAAM,IAAI;QAChB,IAAI,MAAM,GAAG,IAAM,QAAQ;QAC3B,IAAI,OAAO,GAAG,IAAM,OAAO,IAAI,MAAM;QACrC,IAAI,GAAG,GAAG;IACZ;AACF;AAEA,SAAS,iBAAiB,IAAY,EAAE,GAAW;IACjD,MAAM,OAAO,KAAK,QAAQ,CAAC,OAAO,KAAK,SAAS,CAAC,GAAG,KAAK,WAAW,CAAC,QAAQ;IAC7E,OAAO,GAAG,KAAK,CAAC,EAAE,KAAK;AACzB;AAEA,SAAS,WAAW,MAAyB,EAAE,OAAe;IAC5D,OAAO,IAAI,QAAQ,CAAC;QAClB,OAAO,MAAM,CACX,CAAC,OAAS,QAAQ,OAClB,cACA,KAAK,GAAG,CAAC,KAAK,KAAK,GAAG,CAAC,GAAG;IAE9B;AACF"}},
    {"offset": {"line": 314, "column": 0}, "map": {"version":3,"sources":["file:///Users/maccrey/Development/Loglingo/src/infrastructure/firebase/diary-repository.ts"],"sourcesContent":["import {\n  Diary,\n  DiaryDraft,\n  DiaryImageUploadResult,\n  DiaryRepository,\n} from \"@/domain/diary\";\nimport { db, storage } from \"@/lib/firebase\";\nimport {\n  addDoc,\n  collection,\n  DocumentData,\n  deleteDoc,\n  doc,\n  getDoc,\n  getDocs,\n  orderBy,\n  query,\n  type DocumentSnapshot,\n  type QueryDocumentSnapshot,\n  serverTimestamp,\n  Timestamp,\n  updateDoc,\n  where,\n} from \"firebase/firestore\";\nimport {\n  getDownloadURL,\n  ref,\n  uploadBytesResumable,\n  UploadTask,\n} from \"firebase/storage\";\n\nconst diariesCollection = collection(db, \"diaries\");\n\nfunction mapDiary(\n  snapshot: DocumentSnapshot<DocumentData> | QueryDocumentSnapshot<DocumentData>\n): Diary {\n  const data = snapshot.data();\n  if (!data) {\n    throw new Error(\"Diary snapshot is missing data\");\n  }\n  const createdAt =\n    data.createdAt instanceof Timestamp\n      ? data.createdAt.toDate()\n      : new Date(data.createdAt ?? Date.now());\n\n  const updatedAt =\n    data.updatedAt instanceof Timestamp\n      ? data.updatedAt.toDate()\n      : data.updatedAt\n      ? new Date(data.updatedAt)\n      : undefined;\n\n  return {\n    id: snapshot.id,\n    userId: data.userId,\n    date: data.date,\n    content: data.content,\n    imageUrl: data.imageUrl,\n    aiReviewed: Boolean(data.aiReviewed),\n    createdAt,\n    updatedAt,\n  };\n}\n\nasync function listByUser(userId: string, year?: number): Promise<Diary[]> {\n  console.log(\"üîç Diary Repository: listByUser called\", { userId, year });\n  \n  if (!userId) {\n    console.log(\"‚ö†Ô∏è Diary Repository: No userId, returning empty array\");\n    return [];\n  }\n\n  try {\n    const constraints = [where(\"userId\", \"==\", userId)];\n    if (year) {\n      constraints.push(where(\"date\", \">=\", `${year}-01-01`));\n      constraints.push(where(\"date\", \"<=\", `${year}-12-31`));\n    }\n\n    // orderByÎ•º ÏûÑÏãúÎ°ú Ï†úÍ±∞ÌïòÏó¨ Ïù∏Îç±Ïä§ Î¨∏Ï†úÏù∏ÏßÄ ÌôïÏù∏\n    const q = query(diariesCollection, ...constraints);\n\n    console.log(\"üîç Diary Repository: Executing query...\");\n    const snapshot = await getDocs(q);\n    const results = snapshot.docs.map(mapDiary);\n    \n    // ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ ÏÇ¨Ïù¥ÎìúÏóêÏÑú Ï†ïÎ†¨\n    results.sort((a, b) => b.date.localeCompare(a.date));\n    \n    console.log(\"‚úÖ Diary Repository: Query complete\", { count: results.length, results: results.slice(0, 2) });\n    return results;\n  } catch (error) {\n    console.error(\"‚ùå Diary Repository: Query failed\", error);\n    throw error;\n  }\n}\n\nasync function getById(userId: string, id: string): Promise<Diary | null> {\n  const refDoc = doc(diariesCollection, id);\n  const snapshot = await getDoc(refDoc);\n  if (!snapshot.exists()) return null;\n  const data = mapDiary(snapshot);\n  if (data.userId !== userId) return null;\n  return data;\n}\n\nasync function create(input: DiaryDraft): Promise<Diary> {\n  const payload = {\n    ...input,\n    aiReviewed: Boolean(input.aiReviewed),\n    createdAt: serverTimestamp(),\n    updatedAt: serverTimestamp(),\n  };\n\n  const refDoc = await addDoc(diariesCollection, payload);\n  const created = await getDoc(refDoc);\n  return mapDiary(created);\n}\n\nasync function update(id: string, input: Partial<DiaryDraft>): Promise<Diary> {\n  const refDoc = doc(diariesCollection, id);\n  await updateDoc(refDoc, { ...input, updatedAt: serverTimestamp() });\n  const updated = await getDoc(refDoc);\n  return mapDiary(updated);\n}\n\nasync function remove(id: string): Promise<void> {\n  const refDoc = doc(diariesCollection, id);\n  await deleteDoc(refDoc);\n}\n\nasync function uploadDiaryImage(\n  file: File,\n  userId: string,\n  onProgress?: (progress: number) => void\n): Promise<DiaryImageUploadResult> {\n  const safeName = file.name.replace(/\\s+/g, \"-\").toLowerCase();\n  const storageRef = ref(\n    storage,\n    `diaryImages/${userId}/${Date.now()}-${safeName}`\n  );\n  const uploadTask: UploadTask = uploadBytesResumable(storageRef, file, {\n    contentType: file.type,\n    cacheControl: \"public,max-age=31536000\",\n  });\n\n  return new Promise((resolve, reject) => {\n    uploadTask.on(\n      \"state_changed\",\n      (snapshot) => {\n        const progress = Math.round(\n          (snapshot.bytesTransferred / snapshot.totalBytes) * 100\n        );\n        onProgress?.(progress);\n      },\n      (error) => reject(error),\n      async () => {\n        const url = await getDownloadURL(uploadTask.snapshot.ref);\n        resolve({ url, path: uploadTask.snapshot.ref.fullPath });\n      }\n    );\n  });\n}\n\nexport const firebaseDiaryRepository: DiaryRepository & {\n  uploadDiaryImage: typeof uploadDiaryImage;\n} = {\n  listByUser,\n  getById,\n  create,\n  update,\n  delete: remove,\n  uploadDiaryImage,\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 446, "column": 0}, "map": {"version":3,"sources":["file:///Users/maccrey/Development/Loglingo/src/application/diary/diary-service.ts"],"sourcesContent":["\"use client\";\n\nimport {\n  Diary,\n  DiaryDraft,\n  DiaryRepository,\n  validateDiaryInput,\n} from \"@/domain/diary\";\nimport { convertImageToWebP } from \"@/lib/image\";\nimport { firebaseDiaryRepository } from \"@/infrastructure/firebase/diary-repository\";\n\nexport interface DiaryPayload {\n  date: string;\n  content: string;\n  imageFile?: File | null;\n  removeImage?: boolean;\n}\n\nexport class DiaryValidationError extends Error {\n  reasons: string[];\n  constructor(reasons: string[]) {\n    super(\"Invalid diary input\");\n    this.reasons = reasons;\n  }\n}\n\nconst repository: DiaryRepository & {\n  uploadDiaryImage: typeof firebaseDiaryRepository.uploadDiaryImage;\n} = firebaseDiaryRepository;\n\nexport async function listDiaries(userId: string, year?: number) {\n  return repository.listByUser(userId, year);\n}\n\nexport async function getDiary(userId: string, id: string) {\n  return repository.getById(userId, id);\n}\n\nexport async function createDiary(\n  userId: string,\n  payload: DiaryPayload,\n  opts?: { onUploadProgress?: (progress: number) => void }\n): Promise<Diary> {\n  const validation = validateDiaryInput({\n    date: payload.date,\n    content: payload.content,\n  });\n\n  if (!validation.valid) {\n    throw new DiaryValidationError(validation.errors);\n  }\n\n  const draft: DiaryDraft = {\n    userId,\n    date: payload.date,\n    content: payload.content.trim(),\n    aiReviewed: false,\n  };\n\n  if (payload.imageFile) {\n    const { file } = await convertImageToWebP(payload.imageFile);\n    const uploaded = await repository.uploadDiaryImage(\n      file,\n      userId,\n      opts?.onUploadProgress\n    );\n    draft.imageUrl = uploaded.url;\n  }\n\n  return repository.create(draft);\n}\n\nexport async function updateDiary(\n  id: string,\n  userId: string,\n  payload: DiaryPayload,\n  opts?: { onUploadProgress?: (progress: number) => void }\n): Promise<Diary> {\n  const validation = validateDiaryInput({\n    date: payload.date,\n    content: payload.content,\n  });\n\n  if (!validation.valid) {\n    throw new DiaryValidationError(validation.errors);\n  }\n\n  const draft: Partial<DiaryDraft> = {\n    date: payload.date,\n    content: payload.content.trim(),\n  };\n\n  if (payload.removeImage) {\n    draft.imageUrl = \"\";\n  }\n\n  if (payload.imageFile) {\n    const { file } = await convertImageToWebP(payload.imageFile);\n    const uploaded = await repository.uploadDiaryImage(\n      file,\n      userId,\n      opts?.onUploadProgress\n    );\n    draft.imageUrl = uploaded.url;\n  }\n\n  return repository.update(id, draft);\n}\n\nexport async function deleteDiary(id: string) {\n  return repository.delete(id);\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;AAEA;AAMA;AACA;AATA;;;;AAkBO,MAAM,6BAA6B;IACxC,QAAkB;IAClB,YAAY,OAAiB,CAAE;QAC7B,KAAK,CAAC;QACN,IAAI,CAAC,OAAO,GAAG;IACjB;AACF;AAEA,MAAM,aAEF,iNAAuB;AAEpB,eAAe,YAAY,MAAc,EAAE,IAAa;IAC7D,OAAO,WAAW,UAAU,CAAC,QAAQ;AACvC;AAEO,eAAe,SAAS,MAAc,EAAE,EAAU;IACvD,OAAO,WAAW,OAAO,CAAC,QAAQ;AACpC;AAEO,eAAe,YACpB,MAAc,EACd,OAAqB,EACrB,IAAwD;IAExD,MAAM,aAAa,IAAA,0KAAkB,EAAC;QACpC,MAAM,QAAQ,IAAI;QAClB,SAAS,QAAQ,OAAO;IAC1B;IAEA,IAAI,CAAC,WAAW,KAAK,EAAE;QACrB,MAAM,IAAI,qBAAqB,WAAW,MAAM;IAClD;IAEA,MAAM,QAAoB;QACxB;QACA,MAAM,QAAQ,IAAI;QAClB,SAAS,QAAQ,OAAO,CAAC,IAAI;QAC7B,YAAY;IACd;IAEA,IAAI,QAAQ,SAAS,EAAE;QACrB,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,IAAA,uKAAkB,EAAC,QAAQ,SAAS;QAC3D,MAAM,WAAW,MAAM,WAAW,gBAAgB,CAChD,MACA,QACA,MAAM;QAER,MAAM,QAAQ,GAAG,SAAS,GAAG;IAC/B;IAEA,OAAO,WAAW,MAAM,CAAC;AAC3B;AAEO,eAAe,YACpB,EAAU,EACV,MAAc,EACd,OAAqB,EACrB,IAAwD;IAExD,MAAM,aAAa,IAAA,0KAAkB,EAAC;QACpC,MAAM,QAAQ,IAAI;QAClB,SAAS,QAAQ,OAAO;IAC1B;IAEA,IAAI,CAAC,WAAW,KAAK,EAAE;QACrB,MAAM,IAAI,qBAAqB,WAAW,MAAM;IAClD;IAEA,MAAM,QAA6B;QACjC,MAAM,QAAQ,IAAI;QAClB,SAAS,QAAQ,OAAO,CAAC,IAAI;IAC/B;IAEA,IAAI,QAAQ,WAAW,EAAE;QACvB,MAAM,QAAQ,GAAG;IACnB;IAEA,IAAI,QAAQ,SAAS,EAAE;QACrB,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,IAAA,uKAAkB,EAAC,QAAQ,SAAS;QAC3D,MAAM,WAAW,MAAM,WAAW,gBAAgB,CAChD,MACA,QACA,MAAM;QAER,MAAM,QAAQ,GAAG,SAAS,GAAG;IAC/B;IAEA,OAAO,WAAW,MAAM,CAAC,IAAI;AAC/B;AAEO,eAAe,YAAY,EAAU;IAC1C,OAAO,WAAW,MAAM,CAAC;AAC3B"}},
    {"offset": {"line": 534, "column": 0}, "map": {"version":3,"sources":["file:///Users/maccrey/Development/Loglingo/src/components/ai/AiFeedback.tsx"],"sourcesContent":["import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/Card\";\nimport { CorrectionResult, CorrectionIssue } from \"@/domain/ai-correction\";\nimport { cn } from \"@/lib/utils\";\nimport { Info, Sparkles, Wand2, Archive } from \"lucide-react\";\nimport { useTranslations } from \"next-intl\";\n\ninterface Props {\n  result: CorrectionResult;\n  onApply?: (text: string) => void;\n  applying?: boolean;\n  onSaveArchive?: () => void;\n  savingArchive?: boolean;\n}\n\nfunction IssueItem({ issue }: { issue: CorrectionIssue }) {\n  return (\n    <div className=\"rounded-lg border border-white/10 bg-white/5 p-3\">\n      <p className=\"text-xs uppercase text-primary mb-1\">{issue.type}</p>\n      <p className=\"text-sm text-foreground\">\n        <span className=\"text-muted-foreground\">Original:</span> {issue.original}\n      </p>\n      <p className=\"text-sm text-foreground\">\n        <span className=\"text-muted-foreground\">Suggestion:</span> {issue.suggestion}\n      </p>\n      <p className=\"text-xs text-muted-foreground mt-1\">{issue.explanation}</p>\n    </div>\n  );\n}\n\nexport function AiFeedback({ result, onApply, applying, onSaveArchive, savingArchive }: Props) {\n  const t = useTranslations(\"ai\");\n\n  return (\n    <Card className=\"border-primary/30 bg-primary/5\">\n      <CardHeader className=\"flex flex-row items-center justify-between space-y-0\">\n        <div className=\"flex items-center gap-2\">\n          <Sparkles className=\"h-5 w-5 text-primary\" />\n          <CardTitle>{t(\"result_title\")}</CardTitle>\n        </div>\n        <div className=\"flex gap-2\">\n          {onSaveArchive && (\n            <button\n              className={cn(\n                \"inline-flex items-center rounded-lg bg-white/10 px-3 py-1.5 text-xs font-medium text-foreground transition hover:bg-white/20\",\n                savingArchive && \"opacity-70\"\n              )}\n              onClick={onSaveArchive}\n              disabled={savingArchive}\n            >\n              <Archive className=\"mr-2 h-4 w-4\" />\n              {savingArchive ? t(\"saving\") : t(\"save_archive\")}\n            </button>\n          )}\n          {onApply && (\n            <button\n              className={cn(\n                \"inline-flex items-center rounded-lg bg-gradient-to-r from-primary to-accent px-3 py-1.5 text-xs font-medium text-primary-foreground shadow transition hover:opacity-90\",\n                applying && \"opacity-70\"\n              )}\n              onClick={() => onApply(result.corrected)}\n              disabled={applying}\n            >\n              <Wand2 className=\"mr-2 h-4 w-4\" />\n              {applying ? t(\"applying\") : t(\"apply\")}\n            </button>\n          )}\n        </div>\n      </CardHeader>\n      <CardContent className=\"space-y-4\">\n        <div className=\"rounded-lg border border-primary/30 bg-black/20 p-3 text-sm leading-relaxed\">\n          {result.corrected}\n        </div>\n\n        {result.rootMeaningGuide && (\n          <div className=\"flex items-start gap-2 rounded-lg border border-white/10 bg-white/5 p-3 text-sm text-muted-foreground\">\n            <Info className=\"h-4 w-4 text-primary mt-0.5\" />\n            <div>\n              <p className=\"font-medium text-foreground\">{t(\"root_meaning\")}</p>\n              <p>{result.rootMeaningGuide}</p>\n            </div>\n          </div>\n        )}\n\n        <div className=\"space-y-2\">\n          <p className=\"text-sm font-semibold text-foreground\">{t(\"issues\")}</p>\n          {result.issues?.length ? (\n            <div className=\"grid gap-2 md:grid-cols-2\">\n              {result.issues.map((issue, idx) => (\n                <IssueItem key={idx} issue={issue} />\n              ))}\n            </div>\n          ) : (\n            <p className=\"text-xs text-muted-foreground\">{t(\"no_issues\")}</p>\n          )}\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n"],"names":[],"mappings":";;;;;AAAA;AAEA;AACA;AAAA;AAAA;AAAA;AACA;;;;;;;AAUA,SAAS,UAAU,EAAE,KAAK,EAA8B;IACtD,qBACE,wNAAC;QAAI,WAAU;;0BACb,wNAAC;gBAAE,WAAU;0BAAuC,MAAM,IAAI;;;;;;0BAC9D,wNAAC;gBAAE,WAAU;;kCACX,wNAAC;wBAAK,WAAU;kCAAwB;;;;;;oBAAgB;oBAAE,MAAM,QAAQ;;;;;;;0BAE1E,wNAAC;gBAAE,WAAU;;kCACX,wNAAC;wBAAK,WAAU;kCAAwB;;;;;;oBAAkB;oBAAE,MAAM,UAAU;;;;;;;0BAE9E,wNAAC;gBAAE,WAAU;0BAAsC,MAAM,WAAW;;;;;;;;;;;;AAG1E;KAbS;AAeF,SAAS,WAAW,EAAE,MAAM,EAAE,OAAO,EAAE,QAAQ,EAAE,aAAa,EAAE,aAAa,EAAS;;IAC3F,MAAM,IAAI,IAAA,uOAAe,EAAC;IAE1B,qBACE,wNAAC,sKAAI;QAAC,WAAU;;0BACd,wNAAC,4KAAU;gBAAC,WAAU;;kCACpB,wNAAC;wBAAI,WAAU;;0CACb,wNAAC,oPAAQ;gCAAC,WAAU;;;;;;0CACpB,wNAAC,2KAAS;0CAAE,EAAE;;;;;;;;;;;;kCAEhB,wNAAC;wBAAI,WAAU;;4BACZ,+BACC,wNAAC;gCACC,WAAW,IAAA,uJAAE,EACX,gIACA,iBAAiB;gCAEnB,SAAS;gCACT,UAAU;;kDAEV,wNAAC,iPAAO;wCAAC,WAAU;;;;;;oCAClB,gBAAgB,EAAE,YAAY,EAAE;;;;;;;4BAGpC,yBACC,wNAAC;gCACC,WAAW,IAAA,uJAAE,EACX,0KACA,YAAY;gCAEd,SAAS,IAAM,QAAQ,OAAO,SAAS;gCACvC,UAAU;;kDAEV,wNAAC,sPAAK;wCAAC,WAAU;;;;;;oCAChB,WAAW,EAAE,cAAc,EAAE;;;;;;;;;;;;;;;;;;;0BAKtC,wNAAC,6KAAW;gBAAC,WAAU;;kCACrB,wNAAC;wBAAI,WAAU;kCACZ,OAAO,SAAS;;;;;;oBAGlB,OAAO,gBAAgB,kBACtB,wNAAC;wBAAI,WAAU;;0CACb,wNAAC,wOAAI;gCAAC,WAAU;;;;;;0CAChB,wNAAC;;kDACC,wNAAC;wCAAE,WAAU;kDAA+B,EAAE;;;;;;kDAC9C,wNAAC;kDAAG,OAAO,gBAAgB;;;;;;;;;;;;;;;;;;kCAKjC,wNAAC;wBAAI,WAAU;;0CACb,wNAAC;gCAAE,WAAU;0CAAyC,EAAE;;;;;;4BACvD,OAAO,MAAM,EAAE,uBACd,wNAAC;gCAAI,WAAU;0CACZ,OAAO,MAAM,CAAC,GAAG,CAAC,CAAC,OAAO,oBACzB,wNAAC;wCAAoB,OAAO;uCAAZ;;;;;;;;;qDAIpB,wNAAC;gCAAE,WAAU;0CAAiC,EAAE;;;;;;;;;;;;;;;;;;;;;;;;AAM5D;GArEgB;;QACJ,uOAAe;;;MADX"}},
    {"offset": {"line": 820, "column": 0}, "map": {"version":3,"sources":["file:///Users/maccrey/Development/Loglingo/src/application/ai/correction-service.ts"],"sourcesContent":["import { CorrectionMode, CorrectionResult } from \"@/domain/ai-correction\";\n\nexport async function requestAiCorrection(params: {\n  content: string;\n  mode?: CorrectionMode;\n  signal?: AbortSignal;\n  locale?: string; // UI language\n  learningLanguage?: string; // deprecated: target language for AI output\n  targetLanguage?: string; // preferred target language for AI output\n}): Promise<CorrectionResult> {\n  const controller = new AbortController();\n  // Align with server timeout; give the model enough time before aborting.\n  const timeout = setTimeout(\n    () => controller.abort(new DOMException(\"AI request timed out\", \"TimeoutError\")),\n    30000\n  );\n  const body = JSON.stringify({\n    content: params.content,\n    mode: params.mode || \"full\",\n    locale: params.locale,\n    learningLanguage: params.learningLanguage,\n    targetLanguage: params.targetLanguage ?? params.learningLanguage ?? params.locale,\n  });\n\n  try {\n    const response = await fetch(\"/api/ai/correct\", {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body,\n      signal: params.signal ?? controller.signal,\n    });\n\n    if (!response.ok) {\n      const err = await response.json().catch(() => null);\n      throw new Error(err?.message || \"AI request failed\");\n    }\n\n    return (await response.json()) as CorrectionResult;\n  } finally {\n    clearTimeout(timeout);\n  }\n}\n"],"names":[],"mappings":";;;;AAEO,eAAe,oBAAoB,MAOzC;IACC,MAAM,aAAa,IAAI;IACvB,yEAAyE;IACzE,MAAM,UAAU,WACd,IAAM,WAAW,KAAK,CAAC,IAAI,aAAa,wBAAwB,kBAChE;IAEF,MAAM,OAAO,KAAK,SAAS,CAAC;QAC1B,SAAS,OAAO,OAAO;QACvB,MAAM,OAAO,IAAI,IAAI;QACrB,QAAQ,OAAO,MAAM;QACrB,kBAAkB,OAAO,gBAAgB;QACzC,gBAAgB,OAAO,cAAc,IAAI,OAAO,gBAAgB,IAAI,OAAO,MAAM;IACnF;IAEA,IAAI;QACF,MAAM,WAAW,MAAM,MAAM,mBAAmB;YAC9C,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;YAC9C;YACA,QAAQ,OAAO,MAAM,IAAI,WAAW,MAAM;QAC5C;QAEA,IAAI,CAAC,SAAS,EAAE,EAAE;YAChB,MAAM,MAAM,MAAM,SAAS,IAAI,GAAG,KAAK,CAAC,IAAM;YAC9C,MAAM,IAAI,MAAM,KAAK,WAAW;QAClC;QAEA,OAAQ,MAAM,SAAS,IAAI;IAC7B,SAAU;QACR,aAAa;IACf;AACF"}},
    {"offset": {"line": 860, "column": 0}, "map": {"version":3,"sources":["file:///Users/maccrey/Development/Loglingo/src/lib/analytics.ts"],"sourcesContent":["export type AnalyticsEvent =\n  | \"ai_correct_clicked\"\n  | \"ai_correct_success\"\n  | \"ai_correct_failure\"\n  | \"quiz_started\"\n  | \"quiz_answered\";\n\nexport function trackEvent(\n  event: AnalyticsEvent,\n  payload?: Record<string, unknown>\n) {\n  // Fire-and-forget to Firebase Analytics if available\n  if (typeof window !== \"undefined\") {\n    import(\"./firebase-analytics\")\n      .then((mod) => mod.logAnalyticsEvent(event, payload))\n      .catch(() => {});\n  }\n\n  if (process.env.NODE_ENV !== \"production\") {\n    console.debug(\"[analytics]\", event, payload);\n  }\n}\n"],"names":[],"mappings":";;;;AAkBM;AAXC,SAAS,WACd,KAAqB,EACrB,OAAiC;IAEjC,qDAAqD;IACrD,wCAAmC;QACjC,gIACG,IAAI,CAAC,CAAC,MAAQ,IAAI,iBAAiB,CAAC,OAAO,UAC3C,KAAK,CAAC,KAAO;IAClB;IAEA,wCAA2C;QACzC,QAAQ,KAAK,CAAC,eAAe,OAAO;IACtC;AACF"}},
    {"offset": {"line": 881, "column": 0}, "map": {"version":3,"sources":["file:///Users/maccrey/Development/Loglingo/src/domain/archive.ts"],"sourcesContent":["export type ArchiveType = \"grammar\" | \"word\";\n\nexport interface LearningArchive {\n  id: string;\n  userId: string;\n  type: ArchiveType;\n  title: string;\n  examples: string[];\n  rootMeaning: string;\n  createdAt: Date;\n}\n\nexport interface LearningArchiveDraft {\n  userId: string;\n  type: ArchiveType;\n  title: string;\n  examples?: string[];\n  rootMeaning?: string;\n}\n\nexport interface QuizQuestion {\n  id: string;\n  archiveId: string;\n  question: string;\n  options: string[];\n  answer: number;\n  explanation: string;\n}\n\nexport function buildQuizFromArchive(entry: LearningArchive): QuizQuestion {\n  const correct = entry.rootMeaning || entry.title;\n  const distractors = entry.examples.slice(0, 3).map((ex, idx) => `${ex} (ex ${idx + 1})`);\n  const options = [correct, ...distractors].slice(0, 4);\n  return {\n    id: `${entry.id}-quiz`,\n    archiveId: entry.id,\n    question: `What is the key meaning/pattern for \"${entry.title}\"?`,\n    options,\n    answer: 0,\n    explanation: entry.rootMeaning || entry.title,\n  };\n}\n"],"names":[],"mappings":";;;;AA6BO,SAAS,qBAAqB,KAAsB;IACzD,MAAM,UAAU,MAAM,WAAW,IAAI,MAAM,KAAK;IAChD,MAAM,cAAc,MAAM,QAAQ,CAAC,KAAK,CAAC,GAAG,GAAG,GAAG,CAAC,CAAC,IAAI,MAAQ,GAAG,GAAG,KAAK,EAAE,MAAM,EAAE,CAAC,CAAC;IACvF,MAAM,UAAU;QAAC;WAAY;KAAY,CAAC,KAAK,CAAC,GAAG;IACnD,OAAO;QACL,IAAI,GAAG,MAAM,EAAE,CAAC,KAAK,CAAC;QACtB,WAAW,MAAM,EAAE;QACnB,UAAU,CAAC,qCAAqC,EAAE,MAAM,KAAK,CAAC,EAAE,CAAC;QACjE;QACA,QAAQ;QACR,aAAa,MAAM,WAAW,IAAI,MAAM,KAAK;IAC/C;AACF"}},
    {"offset": {"line": 908, "column": 0}, "map": {"version":3,"sources":["file:///Users/maccrey/Development/Loglingo/src/infrastructure/firebase/archive-repository.ts"],"sourcesContent":["import {\n  LearningArchive,\n  LearningArchiveDraft,\n} from \"@/domain/archive\";\nimport { db } from \"@/lib/firebase\";\nimport {\n  addDoc,\n  collection,\n  getDocs,\n  orderBy,\n  query,\n  serverTimestamp,\n  Timestamp,\n  where,\n  QueryDocumentSnapshot,\n  DocumentData,\n} from \"firebase/firestore\";\n\nconst archiveCol = collection(db, \"learning_archive\");\n\nfunction mapArchive(doc: QueryDocumentSnapshot<DocumentData>): LearningArchive {\n  const data = doc.data();\n  const createdAt =\n    data.createdAt instanceof Timestamp\n      ? data.createdAt.toDate()\n      : new Date(data.createdAt ?? Date.now());\n  return {\n    id: doc.id,\n    userId: data.userId,\n    type: data.type,\n    title: data.title,\n    examples: data.examples || [],\n    rootMeaning: data.rootMeaning || \"\",\n    createdAt,\n  };\n}\n\nexport async function listArchive(userId: string, type?: string) {\n  console.log(\"üîç Archive Repository: listArchive called\", { userId, type });\n  \n  if (!userId) {\n    console.log(\"‚ö†Ô∏è Archive Repository: No userId, returning empty array\");\n    return [];\n  }\n\n  try {\n    const filters = [where(\"userId\", \"==\", userId)];\n    if (type) filters.push(where(\"type\", \"==\", type));\n\n    // orderByÎ•º ÏûÑÏãúÎ°ú Ï†úÍ±∞ÌïòÏó¨ Ïù∏Îç±Ïä§ Î¨∏Ï†úÏù∏ÏßÄ ÌôïÏù∏\n    const q = query(archiveCol, ...filters);\n\n    console.log(\"üîç Archive Repository: Executing query...\");\n    const snapshot = await getDocs(q);\n    const results = snapshot.docs.map(mapArchive);\n    \n    // ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ ÏÇ¨Ïù¥ÎìúÏóêÏÑú Ï†ïÎ†¨\n    results.sort((a, b) => b.createdAt.getTime() - a.createdAt.getTime());\n    \n    console.log(\"‚úÖ Archive Repository: Query complete\", { count: results.length, results: results.slice(0, 2) });\n    return results;\n  } catch (error) {\n    console.error(\"‚ùå Archive Repository: Query failed\", error);\n    throw error;\n  }\n}\n\nexport async function checkDuplicate(userId: string, title: string): Promise<boolean> {\n  console.log(\"üîç Archive Repository: checkDuplicate\", { userId, title });\n  \n  if (!userId || !title) {\n    return false;\n  }\n\n  try {\n    const q = query(\n      archiveCol,\n      where(\"userId\", \"==\", userId),\n      where(\"title\", \"==\", title)\n    );\n    \n    const snapshot = await getDocs(q);\n    const exists = !snapshot.empty;\n    \n    console.log(exists ? \"‚ö†Ô∏è Archive Repository: Duplicate found\" : \"‚úÖ Archive Repository: No duplicate\");\n    return exists;\n  } catch (error) {\n    console.error(\"‚ùå Archive Repository: Check duplicate failed\", error);\n    return false;\n  }\n}\n\nexport async function createArchive(input: LearningArchiveDraft): Promise<LearningArchive> {\n  const payload = {\n    ...input,\n    createdAt: serverTimestamp(),\n  };\n  const ref = await addDoc(archiveCol, payload);\n  const saved = await getDocs(query(archiveCol, where(\"__name__\", \"==\", ref.id)));\n  return saved.docs.map(mapArchive)[0];\n}\n"],"names":[],"mappings":";;;;;;;;AAIA;AACA;AAAA;;;AAaA,MAAM,aAAa,IAAA,2MAAU,EAAC,0JAAE,EAAE;AAElC,SAAS,WAAW,GAAwC;IAC1D,MAAM,OAAO,IAAI,IAAI;IACrB,MAAM,YACJ,KAAK,SAAS,YAAY,0MAAS,GAC/B,KAAK,SAAS,CAAC,MAAM,KACrB,IAAI,KAAK,KAAK,SAAS,IAAI,KAAK,GAAG;IACzC,OAAO;QACL,IAAI,IAAI,EAAE;QACV,QAAQ,KAAK,MAAM;QACnB,MAAM,KAAK,IAAI;QACf,OAAO,KAAK,KAAK;QACjB,UAAU,KAAK,QAAQ,IAAI,EAAE;QAC7B,aAAa,KAAK,WAAW,IAAI;QACjC;IACF;AACF;AAEO,eAAe,YAAY,MAAc,EAAE,IAAa;IAC7D,QAAQ,GAAG,CAAC,6CAA6C;QAAE;QAAQ;IAAK;IAExE,IAAI,CAAC,QAAQ;QACX,QAAQ,GAAG,CAAC;QACZ,OAAO,EAAE;IACX;IAEA,IAAI;QACF,MAAM,UAAU;YAAC,IAAA,sMAAK,EAAC,UAAU,MAAM;SAAQ;QAC/C,IAAI,MAAM,QAAQ,IAAI,CAAC,IAAA,sMAAK,EAAC,QAAQ,MAAM;QAE3C,gCAAgC;QAChC,MAAM,IAAI,IAAA,sMAAK,EAAC,eAAe;QAE/B,QAAQ,GAAG,CAAC;QACZ,MAAM,WAAW,MAAM,IAAA,wMAAO,EAAC;QAC/B,MAAM,UAAU,SAAS,IAAI,CAAC,GAAG,CAAC;QAElC,iBAAiB;QACjB,QAAQ,IAAI,CAAC,CAAC,GAAG,IAAM,EAAE,SAAS,CAAC,OAAO,KAAK,EAAE,SAAS,CAAC,OAAO;QAElE,QAAQ,GAAG,CAAC,wCAAwC;YAAE,OAAO,QAAQ,MAAM;YAAE,SAAS,QAAQ,KAAK,CAAC,GAAG;QAAG;QAC1G,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,sCAAsC;QACpD,MAAM;IACR;AACF;AAEO,eAAe,eAAe,MAAc,EAAE,KAAa;IAChE,QAAQ,GAAG,CAAC,yCAAyC;QAAE;QAAQ;IAAM;IAErE,IAAI,CAAC,UAAU,CAAC,OAAO;QACrB,OAAO;IACT;IAEA,IAAI;QACF,MAAM,IAAI,IAAA,sMAAK,EACb,YACA,IAAA,sMAAK,EAAC,UAAU,MAAM,SACtB,IAAA,sMAAK,EAAC,SAAS,MAAM;QAGvB,MAAM,WAAW,MAAM,IAAA,wMAAO,EAAC;QAC/B,MAAM,SAAS,CAAC,SAAS,KAAK;QAE9B,QAAQ,GAAG,CAAC,SAAS,2CAA2C;QAChE,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,gDAAgD;QAC9D,OAAO;IACT;AACF;AAEO,eAAe,cAAc,KAA2B;IAC7D,MAAM,UAAU;QACd,GAAG,KAAK;QACR,WAAW,IAAA,gNAAe;IAC5B;IACA,MAAM,MAAM,MAAM,IAAA,uMAAM,EAAC,YAAY;IACrC,MAAM,QAAQ,MAAM,IAAA,wMAAO,EAAC,IAAA,sMAAK,EAAC,YAAY,IAAA,sMAAK,EAAC,YAAY,MAAM,IAAI,EAAE;IAC5E,OAAO,MAAM,IAAI,CAAC,GAAG,CAAC,WAAW,CAAC,EAAE;AACtC"}},
    {"offset": {"line": 1001, "column": 0}, "map": {"version":3,"sources":["file:///Users/maccrey/Development/Loglingo/src/application/archive/archive-service.ts"],"sourcesContent":["import {\n  buildQuizFromArchive,\n  LearningArchive,\n  LearningArchiveDraft,\n  QuizQuestion,\n} from \"@/domain/archive\";\nimport { createArchive, listArchive } from \"@/infrastructure/firebase/archive-repository\";\n\nexport async function saveArchiveEntry(input: LearningArchiveDraft) {\n  if (!input.title.trim()) {\n    throw new Error(\"title-required\");\n  }\n  return createArchive({\n    ...input,\n    examples: input.examples?.filter(Boolean) ?? [],\n    rootMeaning: input.rootMeaning ?? \"\",\n  });\n}\n\nexport async function getArchives(userId: string, type?: string): Promise<LearningArchive[]> {\n  return listArchive(userId, type);\n}\n\nexport function generateQuiz(entry: LearningArchive): QuizQuestion {\n  return buildQuizFromArchive(entry);\n}\n"],"names":[],"mappings":";;;;;;;;AAAA;AAMA;;;AAEO,eAAe,iBAAiB,KAA2B;IAChE,IAAI,CAAC,MAAM,KAAK,CAAC,IAAI,IAAI;QACvB,MAAM,IAAI,MAAM;IAClB;IACA,OAAO,IAAA,yMAAa,EAAC;QACnB,GAAG,KAAK;QACR,UAAU,MAAM,QAAQ,EAAE,OAAO,YAAY,EAAE;QAC/C,aAAa,MAAM,WAAW,IAAI;IACpC;AACF;AAEO,eAAe,YAAY,MAAc,EAAE,IAAa;IAC7D,OAAO,IAAA,uMAAW,EAAC,QAAQ;AAC7B;AAEO,SAAS,aAAa,KAAsB;IACjD,OAAO,IAAA,8KAAoB,EAAC;AAC9B"}},
    {"offset": {"line": 1036, "column": 0}, "map": {"version":3,"sources":["file:///Users/maccrey/Development/Loglingo/src/domain/quiz.ts"],"sourcesContent":["export interface Quiz {\n  id: string;\n  archiveId: string;\n  question: string;\n  options: string[];\n  correctIndex: number;\n  explanation: string;\n  createdAt: Date;\n}\n\nexport interface QuizDraft {\n  archiveId: string;\n  question: string;\n  options: string[];\n  correctIndex: number;\n  explanation: string;\n}\n\n/**\n * Randomize quiz options and return with new correct index\n */\nexport function randomizeQuizOptions(quiz: Quiz): Quiz {\n  const shuffled = quiz.options\n    .map((option, index) => ({ option, index }))\n    .sort(() => Math.random() - 0.5);\n  \n  const newCorrectIndex = shuffled.findIndex(\n    item => item.index === quiz.correctIndex\n  );\n  \n  return {\n    ...quiz,\n    options: shuffled.map(item => item.option),\n    correctIndex: newCorrectIndex,\n  };\n}\n"],"names":[],"mappings":";;;;AAqBO,SAAS,qBAAqB,IAAU;IAC7C,MAAM,WAAW,KAAK,OAAO,CAC1B,GAAG,CAAC,CAAC,QAAQ,QAAU,CAAC;YAAE;YAAQ;QAAM,CAAC,GACzC,IAAI,CAAC,IAAM,KAAK,MAAM,KAAK;IAE9B,MAAM,kBAAkB,SAAS,SAAS,CACxC,CAAA,OAAQ,KAAK,KAAK,KAAK,KAAK,YAAY;IAG1C,OAAO;QACL,GAAG,IAAI;QACP,SAAS,SAAS,GAAG,CAAC,CAAA,OAAQ,KAAK,MAAM;QACzC,cAAc;IAChB;AACF"}},
    {"offset": {"line": 1059, "column": 0}, "map": {"version":3,"sources":["file:///Users/maccrey/Development/Loglingo/src/infrastructure/firebase/quiz-repository.ts"],"sourcesContent":["import { Quiz, QuizDraft } from \"@/domain/quiz\";\nimport { db } from \"@/lib/firebase\";\nimport {\n  addDoc,\n  collection,\n  getDocs,\n  query,\n  where,\n  serverTimestamp,\n  Timestamp,\n  QueryDocumentSnapshot,\n  DocumentData,\n} from \"firebase/firestore\";\n\nconst quizzesCollection = collection(db, \"quizzes\");\n\nfunction mapQuiz(snapshot: QueryDocumentSnapshot<DocumentData>): Quiz {\n  const data = snapshot.data();\n  const createdAt =\n    data.createdAt instanceof Timestamp\n      ? data.createdAt.toDate()\n      : new Date(data.createdAt ?? Date.now());\n\n  return {\n    id: snapshot.id,\n    archiveId: data.archiveId,\n    question: data.question,\n    options: data.options || [],\n    correctIndex: data.correctIndex ?? 0,\n    explanation: data.explanation || \"\",\n    createdAt,\n  };\n}\n\nexport async function getQuizByArchiveId(\n  archiveId: string\n): Promise<Quiz | null> {\n  console.log(\"üîç Quiz Repository: getQuizByArchiveId called\", { archiveId });\n  \n  if (!archiveId) {\n    console.log(\"‚ö†Ô∏è Quiz Repository: No archiveId provided\");\n    return null;\n  }\n\n  try {\n    const q = query(quizzesCollection, where(\"archiveId\", \"==\", archiveId));\n    const snapshot = await getDocs(q);\n\n    if (snapshot.empty) {\n      console.log(\"üì≠ Quiz Repository: No quiz found for archiveId\", archiveId);\n      return null;\n    }\n\n    const quiz = mapQuiz(snapshot.docs[0]);\n    console.log(\"‚úÖ Quiz Repository: Quiz found\", { quizId: quiz.id });\n    return quiz;\n  } catch (error) {\n    console.error(\"‚ùå Quiz Repository: Query failed\", error);\n    return null;\n  }\n}\n\nexport async function createQuiz(draft: QuizDraft): Promise<Quiz> {\n  console.log(\"üíæ Quiz Repository: Creating quiz\", { archiveId: draft.archiveId });\n  \n  const payload = {\n    ...draft,\n    createdAt: serverTimestamp(),\n  };\n\n  const docRef = await addDoc(quizzesCollection, payload);\n  const snapshot = await getDocs(\n    query(quizzesCollection, where(\"__name__\", \"==\", docRef.id))\n  );\n\n  const quiz = mapQuiz(snapshot.docs[0]);\n  console.log(\"‚úÖ Quiz Repository: Quiz created\", { quizId: quiz.id });\n  return quiz;\n}\n"],"names":[],"mappings":";;;;;;AACA;AACA;AAAA;;;AAYA,MAAM,oBAAoB,IAAA,2MAAU,EAAC,0JAAE,EAAE;AAEzC,SAAS,QAAQ,QAA6C;IAC5D,MAAM,OAAO,SAAS,IAAI;IAC1B,MAAM,YACJ,KAAK,SAAS,YAAY,0MAAS,GAC/B,KAAK,SAAS,CAAC,MAAM,KACrB,IAAI,KAAK,KAAK,SAAS,IAAI,KAAK,GAAG;IAEzC,OAAO;QACL,IAAI,SAAS,EAAE;QACf,WAAW,KAAK,SAAS;QACzB,UAAU,KAAK,QAAQ;QACvB,SAAS,KAAK,OAAO,IAAI,EAAE;QAC3B,cAAc,KAAK,YAAY,IAAI;QACnC,aAAa,KAAK,WAAW,IAAI;QACjC;IACF;AACF;AAEO,eAAe,mBACpB,SAAiB;IAEjB,QAAQ,GAAG,CAAC,iDAAiD;QAAE;IAAU;IAEzE,IAAI,CAAC,WAAW;QACd,QAAQ,GAAG,CAAC;QACZ,OAAO;IACT;IAEA,IAAI;QACF,MAAM,IAAI,IAAA,sMAAK,EAAC,mBAAmB,IAAA,sMAAK,EAAC,aAAa,MAAM;QAC5D,MAAM,WAAW,MAAM,IAAA,wMAAO,EAAC;QAE/B,IAAI,SAAS,KAAK,EAAE;YAClB,QAAQ,GAAG,CAAC,mDAAmD;YAC/D,OAAO;QACT;QAEA,MAAM,OAAO,QAAQ,SAAS,IAAI,CAAC,EAAE;QACrC,QAAQ,GAAG,CAAC,iCAAiC;YAAE,QAAQ,KAAK,EAAE;QAAC;QAC/D,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,mCAAmC;QACjD,OAAO;IACT;AACF;AAEO,eAAe,WAAW,KAAgB;IAC/C,QAAQ,GAAG,CAAC,qCAAqC;QAAE,WAAW,MAAM,SAAS;IAAC;IAE9E,MAAM,UAAU;QACd,GAAG,KAAK;QACR,WAAW,IAAA,gNAAe;IAC5B;IAEA,MAAM,SAAS,MAAM,IAAA,uMAAM,EAAC,mBAAmB;IAC/C,MAAM,WAAW,MAAM,IAAA,wMAAO,EAC5B,IAAA,sMAAK,EAAC,mBAAmB,IAAA,sMAAK,EAAC,YAAY,MAAM,OAAO,EAAE;IAG5D,MAAM,OAAO,QAAQ,SAAS,IAAI,CAAC,EAAE;IACrC,QAAQ,GAAG,CAAC,mCAAmC;QAAE,QAAQ,KAAK,EAAE;IAAC;IACjE,OAAO;AACT"}},
    {"offset": {"line": 1132, "column": 0}, "map": {"version":3,"sources":["file:///Users/maccrey/Development/Loglingo/src/application/quiz/quiz-service.ts"],"sourcesContent":["import { Quiz, QuizDraft, randomizeQuizOptions } from \"@/domain/quiz\";\nimport { getQuizByArchiveId, createQuiz } from \"@/infrastructure/firebase/quiz-repository\";\n\ninterface GenerateQuizRequest {\n  title: string;\n  rootMeaning: string;\n  examples: string[];\n  uiLocale: string;\n  learningLanguage: string;\n}\n\nasync function generateQuizWithGrok(\n  request: GenerateQuizRequest\n): Promise<{ options: string[]; correctIndex: number; explanation: string } | null> {\n  try {\n    const response = await fetch(\"/api/quiz/generate\", {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify(request),\n    });\n\n    if (!response.ok) {\n      console.error(\"Quiz generation API failed:\", response.status);\n      return null;\n    }\n\n    return await response.json();\n  } catch (error) {\n    console.error(\"Quiz generation request failed:\", error);\n    return null;\n  }\n}\n\nexport async function getOrGenerateQuiz(\n  archiveId: string,\n  title: string,\n  rootMeaning: string,\n  examples: string[],\n  question: string,\n  uiLocale: string,\n  learningLanguage: string\n): Promise<Quiz | null> {\n  console.log(\"üéØ Quiz Service: getOrGenerateQuiz\", { archiveId, title });\n\n  // 1. Check if quiz exists in Firebase\n  const existingQuiz = await getQuizByArchiveId(archiveId);\n  if (existingQuiz) {\n    console.log(\"‚úÖ Quiz Service: Found existing quiz\", { quizId: existingQuiz.id });\n    return randomizeQuizOptions(existingQuiz);\n  }\n\n  console.log(\"ü§ñ Quiz Service: No quiz found, generating with Grok AI...\");\n\n  // 2. Generate quiz with Grok AI\n  const generated = await generateQuizWithGrok({\n    title,\n    rootMeaning,\n    examples,\n    uiLocale,\n    learningLanguage,\n  });\n\n  if (!generated) {\n    console.error(\"‚ùå Quiz Service: Quiz generation failed\");\n    return null;\n  }\n\n  // 3. Save to Firebase\n  const draft: QuizDraft = {\n    archiveId,\n    question,\n    options: generated.options,\n    correctIndex: generated.correctIndex,\n    explanation: generated.explanation,\n  };\n\n  const savedQuiz = await createQuiz(draft);\n  console.log(\"üíæ Quiz Service: Quiz saved to Firebase\", { quizId: savedQuiz.id });\n\n  return randomizeQuizOptions(savedQuiz);\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAUA,eAAe,qBACb,OAA4B;IAE5B,IAAI;QACF,MAAM,WAAW,MAAM,MAAM,sBAAsB;YACjD,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;YAC9C,MAAM,KAAK,SAAS,CAAC;QACvB;QAEA,IAAI,CAAC,SAAS,EAAE,EAAE;YAChB,QAAQ,KAAK,CAAC,+BAA+B,SAAS,MAAM;YAC5D,OAAO;QACT;QAEA,OAAO,MAAM,SAAS,IAAI;IAC5B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,mCAAmC;QACjD,OAAO;IACT;AACF;AAEO,eAAe,kBACpB,SAAiB,EACjB,KAAa,EACb,WAAmB,EACnB,QAAkB,EAClB,QAAgB,EAChB,QAAgB,EAChB,gBAAwB;IAExB,QAAQ,GAAG,CAAC,sCAAsC;QAAE;QAAW;IAAM;IAErE,sCAAsC;IACtC,MAAM,eAAe,MAAM,IAAA,2MAAkB,EAAC;IAC9C,IAAI,cAAc;QAChB,QAAQ,GAAG,CAAC,uCAAuC;YAAE,QAAQ,aAAa,EAAE;QAAC;QAC7E,OAAO,IAAA,2KAAoB,EAAC;IAC9B;IAEA,QAAQ,GAAG,CAAC;IAEZ,gCAAgC;IAChC,MAAM,YAAY,MAAM,qBAAqB;QAC3C;QACA;QACA;QACA;QACA;IACF;IAEA,IAAI,CAAC,WAAW;QACd,QAAQ,KAAK,CAAC;QACd,OAAO;IACT;IAEA,sBAAsB;IACtB,MAAM,QAAmB;QACvB;QACA;QACA,SAAS,UAAU,OAAO;QAC1B,cAAc,UAAU,YAAY;QACpC,aAAa,UAAU,WAAW;IACpC;IAEA,MAAM,YAAY,MAAM,IAAA,mMAAU,EAAC;IACnC,QAAQ,GAAG,CAAC,2CAA2C;QAAE,QAAQ,UAAU,EAAE;IAAC;IAE9E,OAAO,IAAA,2KAAoB,EAAC;AAC9B"}},
    {"offset": {"line": 1206, "column": 0}, "map": {"version":3,"sources":["file:///Users/maccrey/Development/Loglingo/src/application/archive/hooks.ts"],"sourcesContent":["\"use client\";\n\nimport { useMutation, useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport { getArchives, saveArchiveEntry } from \"./archive-service\";\nimport { LearningArchive, buildQuizFromArchive } from \"@/domain/archive\";\nimport { Quiz } from \"@/domain/quiz\";\nimport { getOrGenerateQuiz } from \"@/application/quiz/quiz-service\";\nimport { useLocale } from \"next-intl\";\nimport { useState, useEffect } from \"react\";\n\nexport function useArchiveList(userId: string, type?: string, opts?: { enabled?: boolean }) {\n  return useQuery<LearningArchive[]>({\n    queryKey: [\"archives\", userId, type ?? \"all\"],\n    queryFn: () => getArchives(userId, type),\n    enabled: (opts?.enabled ?? true) && Boolean(userId),\n    staleTime: 60_000,\n    refetchOnMount: true,\n  });\n}\n\nexport function useArchiveMutations(userId: string) {\n  const client = useQueryClient();\n  const create = useMutation({\n    mutationFn: saveArchiveEntry,\n    onSuccess: () => client.invalidateQueries({ queryKey: [\"archives\", userId] }),\n  });\n  return { create };\n}\n\nexport function useQuiz(\n  entry?: LearningArchive,\n  translatedQuestion?: string,\n  uiLocale?: string,\n  learningLanguage?: string\n) {\n  const [quiz, setQuiz] = useState<Quiz | null>(null);\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    if (!entry || !translatedQuestion) {\n      setQuiz(null);\n      setIsLoading(false);\n      return;\n    }\n\n    let cancelled = false;\n\n    async function loadQuiz() {\n      if (!entry || !translatedQuestion) return;\n\n      setIsLoading(true);\n      setError(null);\n\n      try {\n        const result = await getOrGenerateQuiz(\n          entry.id,\n          entry.title,\n          entry.rootMeaning || entry.title,\n          entry.examples || [],\n          translatedQuestion,\n          uiLocale || \"en\",\n          learningLanguage || \"en\"\n        );\n\n        if (!cancelled) {\n          setQuiz(result);\n          if (!result) {\n            setError(\"Quiz generation failed\");\n          }\n        }\n      } catch (err) {\n        if (!cancelled) {\n          console.error(\"Quiz loading error:\", err);\n          setError(\"Failed to load quiz\");\n          setQuiz(null);\n        }\n      } finally {\n        if (!cancelled) {\n          setIsLoading(false);\n        }\n      }\n    }\n\n    loadQuiz();\n\n    return () => {\n      cancelled = true;\n    };\n  }, [entry?.id, translatedQuestion, uiLocale, learningLanguage]);\n\n  return { quiz, isLoading, error };\n}\n"],"names":[],"mappings":";;;;;;;;AAEA;AAAA;AAAA;AACA;AAGA;AAEA;;AARA;;;;;AAUO,SAAS,eAAe,MAAc,EAAE,IAAa,EAAE,IAA4B;;IACxF,OAAO,IAAA,qNAAQ,EAAoB;QACjC,UAAU;YAAC;YAAY;YAAQ,QAAQ;SAAM;QAC7C,OAAO;uCAAE,IAAM,IAAA,gMAAW,EAAC,QAAQ;;QACnC,SAAS,CAAC,MAAM,WAAW,IAAI,KAAK,QAAQ;QAC5C,WAAW;QACX,gBAAgB;IAClB;AACF;GARgB;;QACP,qNAAQ;;;AASV,SAAS,oBAAoB,MAAc;;IAChD,MAAM,SAAS,IAAA,sOAAc;IAC7B,MAAM,SAAS,IAAA,2NAAW,EAAC;QACzB,YAAY,qMAAgB;QAC5B,SAAS;uDAAE,IAAM,OAAO,iBAAiB,CAAC;oBAAE,UAAU;wBAAC;wBAAY;qBAAO;gBAAC;;IAC7E;IACA,OAAO;QAAE;IAAO;AAClB;IAPgB;;QACC,sOAAc;QACd,2NAAW;;;AAOrB,SAAS,QACd,KAAuB,EACvB,kBAA2B,EAC3B,QAAiB,EACjB,gBAAyB;;IAEzB,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,oMAAQ,EAAc;IAC9C,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,oMAAQ,EAAC;IAC3C,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,oMAAQ,EAAgB;IAElD,IAAA,qMAAS;6BAAC;YACR,IAAI,CAAC,SAAS,CAAC,oBAAoB;gBACjC,QAAQ;gBACR,aAAa;gBACb;YACF;YAEA,IAAI,YAAY;YAEhB,eAAe;gBACb,IAAI,CAAC,SAAS,CAAC,oBAAoB;gBAEnC,aAAa;gBACb,SAAS;gBAET,IAAI;oBACF,MAAM,SAAS,MAAM,IAAA,gMAAiB,EACpC,MAAM,EAAE,EACR,MAAM,KAAK,EACX,MAAM,WAAW,IAAI,MAAM,KAAK,EAChC,MAAM,QAAQ,IAAI,EAAE,EACpB,oBACA,YAAY,MACZ,oBAAoB;oBAGtB,IAAI,CAAC,WAAW;wBACd,QAAQ;wBACR,IAAI,CAAC,QAAQ;4BACX,SAAS;wBACX;oBACF;gBACF,EAAE,OAAO,KAAK;oBACZ,IAAI,CAAC,WAAW;wBACd,QAAQ,KAAK,CAAC,uBAAuB;wBACrC,SAAS;wBACT,QAAQ;oBACV;gBACF,SAAU;oBACR,IAAI,CAAC,WAAW;wBACd,aAAa;oBACf;gBACF;YACF;YAEA;YAEA;qCAAO;oBACL,YAAY;gBACd;;QACF;4BAAG;QAAC,OAAO;QAAI;QAAoB;QAAU;KAAiB;IAE9D,OAAO;QAAE;QAAM;QAAW;IAAM;AAClC;IA/DgB"}},
    {"offset": {"line": 1335, "column": 0}, "map": {"version":3,"sources":["file:///Users/maccrey/Development/Loglingo/src/lib/current-user.ts"],"sourcesContent":["import { auth } from \"@/lib/firebase\";\n\n// Returns Firebase UID if logged in, otherwise a local fallback for demo.\nexport function getCurrentUserId() {\n  if (typeof window !== \"undefined\" && auth.currentUser?.uid) {\n    return auth.currentUser.uid;\n  }\n  return \"demo-user\";\n}\n"],"names":[],"mappings":";;;;AAAA;;AAGO,SAAS;IACd,IAAI,+CAAkB,eAAe,4JAAI,CAAC,WAAW,EAAE,KAAK;QAC1D,OAAO,4JAAI,CAAC,WAAW,CAAC,GAAG;IAC7B;IACA,OAAO;AACT"}},
    {"offset": {"line": 1354, "column": 0}, "map": {"version":3,"sources":["file:///Users/maccrey/Development/Loglingo/src/components/diary/DiaryForm.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { Button } from \"@/components/ui/Button\";\nimport { Input } from \"@/components/ui/Input\";\nimport {\n  Card,\n  CardContent,\n  CardFooter,\n  CardHeader,\n  CardTitle,\n} from \"@/components/ui/Card\";\nimport { Diary } from \"@/domain/diary\";\nimport {\n  DiaryPayload,\n  DiaryValidationError,\n} from \"@/application/diary/diary-service\";\nimport { getImagePreview } from \"@/lib/image\";\nimport { toast } from \"sonner\";\nimport { Image as ImageIcon, Loader2, Sparkles, Trash2 } from \"lucide-react\";\nimport { useLocale, useTranslations } from \"next-intl\";\nimport { useRouter } from \"@/i18n/routing\";\nimport NextImage from \"next/image\";\nimport { AiFeedback } from \"../ai/AiFeedback\";\nimport { requestAiCorrection } from \"@/application/ai/correction-service\";\nimport { trackEvent } from \"@/lib/analytics\";\nimport { CorrectionResult } from \"@/domain/ai-correction\";\nimport { useArchiveMutations } from \"@/application/archive/hooks\";\nimport { getCurrentUserId } from \"@/lib/current-user\";\nimport { useLearningLanguage } from \"@/application/i18n/LearningLanguageProvider\";\nimport { auth } from \"@/lib/firebase\";\n\ntype DiaryFormProps = {\n  initial?: Diary | null;\n  onSubmit: (payload: DiaryPayload & { onUploadProgress?: (n: number) => void }) => Promise<void>;\n  onDelete?: () => Promise<void>;\n  isSubmitting?: boolean;\n};\n\nfunction today() {\n  return new Date().toISOString().split(\"T\")[0];\n}\n\nexport function DiaryForm({ initial, onSubmit, onDelete, isSubmitting }: DiaryFormProps) {\n  const t = useTranslations(\"write\");\n  const tDiary = useTranslations(\"diary\");\n  const locale = useLocale();\n  const router = useRouter();\n  const userId = getCurrentUserId() || auth.currentUser?.uid || \"\";\n  const { learningLanguage } = useLearningLanguage();\n  const { create: createArchive } = useArchiveMutations(userId);\n  const validationKeyMap: Record<string, string> = {\n    \"invalid-date\": \"validation_invalid_date\",\n    \"empty-content\": \"validation_empty_content\",\n    \"too-long\": \"validation_too_long\",\n  };\n\n  const [date, setDate] = useState(initial?.date ?? today());\n  const [content, setContent] = useState(initial?.content ?? \"\");\n  const [imageFile, setImageFile] = useState<File | null>(null);\n  const [imagePreview, setImagePreview] = useState<string | undefined>(initial?.imageUrl);\n  const [removeImage, setRemoveImage] = useState(false);\n  const [uploadProgress, setUploadProgress] = useState(0);\n  const [errors, setErrors] = useState<string[]>([]);\n  const [deleting, setDeleting] = useState(false);\n  const [aiResult, setAiResult] = useState<CorrectionResult | null>(null);\n  const [aiLoading, setAiLoading] = useState(false);\n  const [savingArchive, setSavingArchive] = useState(false);\n\n  useEffect(() => {\n    if (initial) {\n      setDate(initial.date);\n      setContent(initial.content);\n      setImagePreview(initial.imageUrl);\n      setRemoveImage(false);\n      setImageFile(null);\n    }\n  }, [initial]);\n\n  const handleFileChange = async (file?: File) => {\n    if (!file) return;\n    if (!file.type.startsWith(\"image/\")) {\n      toast.error(t(\"validation_image\"));\n      return;\n    }\n    setRemoveImage(false);\n    setImageFile(file);\n    const preview = await getImagePreview(file);\n    setImagePreview(preview);\n  };\n\n  const openFilePicker = () => {\n    const input = document.createElement(\"input\");\n    input.type = \"file\";\n    input.accept = \"image/*\";\n    input.onchange = (event: Event) => {\n      const target = event.target as HTMLInputElement;\n      handleFileChange(target.files?.[0] || undefined);\n    };\n    input.click();\n  };\n\n  const handleSubmit = async (event: React.FormEvent) => {\n    event.preventDefault();\n    setErrors([]);\n\n    try {\n      await onSubmit({\n        date,\n        content,\n        imageFile,\n        removeImage,\n        onUploadProgress: (progress) => setUploadProgress(progress),\n      });\n      toast.success(t(\"saved\"));\n      setUploadProgress(0);\n      if (!initial) {\n        setContent(\"\");\n        setImageFile(null);\n        setImagePreview(undefined);\n      }\n    } catch (error: unknown) {\n      if (error instanceof DiaryValidationError) {\n        setErrors(error.reasons);\n        return;\n      }\n      toast.error(t(\"upload_failed\"));\n    }\n  };\n\n  const handleDelete = async () => {\n    if (!onDelete) return;\n    if (!confirm(tDiary(\"confirm_delete\"))) return;\n    try {\n      setDeleting(true);\n      await onDelete();\n      toast.success(tDiary(\"delete_success\"));\n      router.push(\"/diary\");\n    } catch {\n      toast.error(tDiary(\"delete_error\"));\n    } finally {\n      setDeleting(false);\n    }\n  };\n\n  const handleAiCheck = async () => {\n    if (!content.trim()) {\n      toast.error(t(\"validation_empty_content\"));\n      return;\n    }\n    setAiLoading(true);\n    setAiResult(null);\n    trackEvent(\"ai_correct_clicked\", { mode: \"full\" });\n    try {\n      const result = await requestAiCorrection({\n        content,\n        mode: \"full\",\n        locale,\n        // ÌïôÏäµ Ïñ∏Ïñ¥Î•º Ïö∞ÏÑ†ÏúºÎ°ú Í≤∞Í≥ºÎ•º Î∞õÎèÑÎ°ù ÏßÄÏ†ï, ÏóÜÏúºÎ©¥ UI Ïñ∏Ïñ¥ ÏÇ¨Ïö©\n        targetLanguage: learningLanguage || locale,\n        learningLanguage,\n      });\n      setAiResult(result);\n      trackEvent(\"ai_correct_success\");\n    } catch (error: unknown) {\n      const message = error instanceof Error ? error.message : \"unknown\";\n      trackEvent(\"ai_correct_failure\", { message });\n      toast.error(t(\"ai_error\"));\n    } finally {\n      setAiLoading(false);\n    }\n  };\n\n  const applyAiResult = async (text: string) => {\n    setContent(text);\n    toast.success(t(\"ai_applied\"));\n    \n    // ÍµêÏ†ï Ï†ÅÏö© Ïãú ÏïÑÏπ¥Ïù¥Î∏åÏóêÎèÑ Ï†ÄÏû•\n    await handleSaveArchive();\n  };\n\n  const handleSaveArchive = async () => {\n    if (!aiResult || !userId) return;\n    try {\n      setSavingArchive(true);\n\n      const entries = [];\n\n      // ÍµêÏ†ïÎêú Ï†ÑÏ≤¥ Î¨∏Ïû•ÏùÑ ÏïÑÏπ¥Ïù¥Î∏åÏóê Ï†ÄÏû•\n      if (aiResult.corrected.trim() && aiResult.rootMeaningGuide) {\n        const title = aiResult.corrected.slice(0, 80);\n        // Ï§ëÎ≥µ Ï≤¥ÌÅ¨Î•º ÏúÑÌï¥ dynamic import\n        const { checkDuplicate } = await import(\"@/infrastructure/firebase/archive-repository\");\n        const isDuplicate = await checkDuplicate(userId, title);\n        \n        if (!isDuplicate) {\n          entries.push({\n            userId,\n            type: \"grammar\" as const,\n            title,\n            rootMeaning: aiResult.rootMeaningGuide,\n            examples: [aiResult.corrected],\n          });\n        } else {\n          console.log(\"‚è≠Ô∏è Skipping duplicate:\", title);\n        }\n      }\n\n      // Í∞Å Ïù¥ÏäàÎ≥ÑÎ°ú Ï†ÄÏû• (Ï§ëÎ≥µ Ï≤¥ÌÅ¨ Ìè¨Ìï®)\n      for (const issue of aiResult.issues || []) {\n        const title = issue.suggestion.slice(0, 80);\n        const { checkDuplicate } = await import(\"@/infrastructure/firebase/archive-repository\");\n        const isDuplicate = await checkDuplicate(userId, title);\n        \n        if (!isDuplicate) {\n          entries.push({\n            userId,\n            type: \"grammar\" as const,\n            title,\n            rootMeaning: issue.explanation || aiResult.rootMeaningGuide || \"AI suggestion\",\n            examples: [issue.original, issue.suggestion].filter(Boolean),\n          });\n        } else {\n          console.log(\"‚è≠Ô∏è Skipping duplicate:\", title);\n        }\n      }\n\n      if (entries.length > 0) {\n        await Promise.all(entries.map((entry) => createArchive.mutateAsync(entry)));\n        toast.success(t(\"ai_saved_archive\"));\n      } else {\n        toast.info(\"Î™®Îëê Ïù¥ÎØ∏ ÏïÑÏπ¥Ïù¥Î∏åÏóê Ï†ÄÏû•ÎêòÏñ¥ ÏûàÏäµÎãàÎã§\");\n      }\n    } catch (error: unknown) {\n      const message = error instanceof Error ? error.message : \"error\";\n      toast.error(`${t(\"upload_failed\")} (${message})`);\n    } finally {\n      setSavingArchive(false);\n    }\n  };\n\n  return (\n    <form onSubmit={handleSubmit} className=\"space-y-6\">\n      <Card>\n        <CardHeader>\n          <CardTitle>{initial ? t(\"edit_title\") : t(\"title\")}</CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n              {errors.length > 0 && (\n                <div className=\"rounded-lg border border-red-500/40 bg-red-500/10 p-3 text-sm text-red-200\">\n                  <ul className=\"space-y-1\">\n                    {errors.map((error) => (\n                      <li key={error}>\n                        {t(validationKeyMap[error] ?? \"validation_invalid_date\")}\n                      </li>\n                    ))}\n                  </ul>\n                </div>\n              )}\n\n          <div className=\"flex flex-col space-y-2\">\n            <label htmlFor=\"date\" className=\"text-sm font-medium text-muted-foreground\">\n              {t(\"date_label\")}\n            </label>\n            <Input\n              id=\"date\"\n              type=\"date\"\n              value={date}\n              onChange={(e) => setDate(e.target.value)}\n              className=\"w-full sm:w-auto\"\n              required\n            />\n          </div>\n\n          <div className=\"flex flex-col space-y-2\">\n            <label htmlFor=\"content\" className=\"text-sm font-medium text-muted-foreground\">\n              {t(\"content_label\")}\n            </label>\n            <textarea\n              id=\"content\"\n              className=\"min-h-[300px] w-full rounded-lg border border-white/10 bg-white/5 p-4 text-base text-foreground placeholder:text-white/40 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary backdrop-blur-sm resize-none\"\n              placeholder={t(\"placeholder\")}\n              value={content}\n              onChange={(e) => setContent(e.target.value)}\n              required\n            />\n            <p className=\"text-xs text-muted-foreground\">\n              {t(\"upload_hint\")}\n            </p>\n          </div>\n\n          <div className=\"flex flex-col gap-3\">\n            {imagePreview ? (\n              <div className=\"relative overflow-hidden rounded-lg border border-white/10 bg-white/5 p-2\">\n                <NextImage\n                  src={imagePreview}\n                  alt=\"Diary attachment\"\n                  width={1200}\n                  height={800}\n                  className=\"h-48 w-full rounded-md object-cover\"\n                  loading=\"lazy\"\n                  sizes=\"(max-width: 768px) 100vw, 640px\"\n                />\n                <div className=\"mt-2 flex items-center gap-2\">\n                  <Button\n                    type=\"button\"\n                    variant=\"secondary\"\n                    size=\"sm\"\n                    onClick={() => {\n                      setRemoveImage(true);\n                      setImagePreview(undefined);\n                      setImageFile(null);\n                    }}\n                  >\n                    <Trash2 className=\"mr-2 h-4 w-4\" />\n                    {t(\"remove_image\")}\n                  </Button>\n                  <Button\n                    type=\"button\"\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    onClick={() => {\n                      setRemoveImage(false);\n                      openFilePicker();\n                    }}\n                  >\n                    {t(\"replace_image\")}\n                  </Button>\n                </div>\n              </div>\n            ) : (\n              <div className=\"flex items-center gap-2\">\n                <Button\n                  type=\"button\"\n                  variant=\"secondary\"\n                  size=\"sm\"\n                  onClick={openFilePicker}\n                >\n                  <ImageIcon className=\"mr-2 h-4 w-4\" />\n                  {t(\"upload_image\")}\n                </Button>\n                <span className=\"text-xs text-muted-foreground\">\n                  {t(\"upload_hint\")}\n                </span>\n              </div>\n            )}\n          </div>\n\n          {uploadProgress > 0 && uploadProgress < 100 && (\n            <div className=\"space-y-2\">\n              <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                <Loader2 className=\"h-4 w-4 animate-spin\" />\n                {t(\"uploading\")} {uploadProgress}%\n              </div>\n              <div className=\"h-2 rounded-full bg-white/10\">\n                <div\n                  className=\"h-full rounded-full bg-gradient-to-r from-primary to-accent transition-all\"\n                  style={{ width: `${uploadProgress}%` }}\n                />\n              </div>\n            </div>\n          )}\n        </CardContent>\n        <CardFooter className=\"flex flex-wrap items-center justify-between gap-3\">\n          <div className=\"flex gap-2\">\n            <Button\n              type=\"button\"\n              variant=\"ghost\"\n              onClick={() => router.push(\"/diary\")}\n            >\n              {t(\"back\")}\n            </Button>\n            <Button\n              type=\"button\"\n              variant=\"glass\"\n              onClick={handleAiCheck}\n              disabled={aiLoading}\n              className=\"border-primary/60 bg-primary/10 text-primary hover:bg-primary/20 hover:text-primary-foreground\"\n            >\n              {aiLoading ? (\n                <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n              ) : (\n                <Sparkles className=\"mr-2 h-4 w-4\" />\n              )}\n              {aiLoading ? t(\"ai_checking\") : t(\"ai_check\")}\n            </Button>\n          </div>\n\n          <div className=\"flex items-center gap-2\">\n            {onDelete && (\n              <Button\n                type=\"button\"\n                variant=\"ghost\"\n                onClick={handleDelete}\n                disabled={deleting}\n              >\n                <Trash2 className=\"mr-2 h-4 w-4\" />\n                {tDiary(\"delete\")}\n              </Button>\n            )}\n            <Button\n              type=\"submit\"\n              disabled={isSubmitting || deleting}\n              className=\"bg-gradient-to-r from-primary to-accent hover:opacity-90 border-0\"\n            >\n              {isSubmitting && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\n              {initial ? t(\"update\") : t(\"save\")}\n            </Button>\n          </div>\n        </CardFooter>\n      </Card>\n      {aiResult && (\n        <AiFeedback\n          result={aiResult}\n          onApply={applyAiResult}\n          applying={isSubmitting}\n          onSaveArchive={handleSaveArchive}\n          savingArchive={savingArchive}\n        />\n      )}\n    </form>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2021, "column": 0}, "map": {"version":3,"sources":["file:///Users/maccrey/Development/Loglingo/src/application/diary/hooks.ts"],"sourcesContent":["\"use client\";\n\nimport { Diary } from \"@/domain/diary\";\nimport {\n  createDiary,\n  deleteDiary,\n  DiaryPayload,\n  getDiary,\n  listDiaries,\n  updateDiary,\n} from \"./diary-service\";\nimport { useMutation, useQuery, useQueryClient } from \"@tanstack/react-query\";\n\nconst listKey = (userId: string, year?: number) => [\n  \"diaries\",\n  userId,\n  year ?? \"all\",\n];\nconst detailKey = (id: string) => [\"diary\", id];\n\nexport function useDiaryList(userId: string, year?: number, opts?: { enabled?: boolean }) {\n  return useQuery({\n    queryKey: listKey(userId, year),\n    queryFn: () => listDiaries(userId, year),\n    enabled: Boolean(userId) && (opts?.enabled ?? true),\n    refetchOnMount: true,\n  });\n}\n\nexport function useDiaryDetail(userId: string, id?: string) {\n  return useQuery({\n    queryKey: detailKey(id || \"new\"),\n    queryFn: () => getDiary(userId, id as string),\n    enabled: Boolean(userId && id),\n  });\n}\n\nexport function useDiaryMutations(userId: string) {\n  const queryClient = useQueryClient();\n  type MutationOptions = DiaryPayload & {\n    onUploadProgress?: (progress: number) => void;\n  };\n\n  const invalidateLists = () =>\n    queryClient.invalidateQueries({ queryKey: [\"diaries\", userId] });\n\n  const updateCachedLists = (\n    updater: (diary: Diary) => Diary | null | undefined\n  ) => {\n    const queries = queryClient.getQueriesData<Diary[]>({\n      queryKey: [\"diaries\", userId],\n    });\n\n    queries.forEach(([key, value]) => {\n      if (!value) return;\n      const next = value\n        .map((item) => updater(item))\n        .filter(Boolean) as Diary[];\n      queryClient.setQueryData(key, next);\n    });\n  };\n\n  const create = useMutation({\n    mutationFn: (payload: MutationOptions) =>\n      createDiary(userId, payload, {\n        onUploadProgress: payload.onUploadProgress,\n      }),\n    onMutate: async (variables: MutationOptions) => {\n      await queryClient.cancelQueries({ queryKey: [\"diaries\", userId] });\n      const previous = queryClient.getQueriesData<Diary[]>({\n        queryKey: [\"diaries\", userId],\n      });\n      const optimistic: Diary = {\n        id: `temp-${Date.now()}`,\n        userId,\n        date: variables.date,\n        content: variables.content,\n        imageUrl: undefined,\n        aiReviewed: false,\n        createdAt: new Date(),\n      };\n      const queries = queryClient.getQueriesData<Diary[]>({\n        queryKey: [\"diaries\", userId],\n      });\n      queries.forEach(([key, value]) => {\n        const next = value ? [optimistic, ...value] : [optimistic];\n        queryClient.setQueryData(key, next);\n      });\n      return { previous };\n    },\n    onError: (_err, _variables, context) => {\n      context?.previous?.forEach(([key, value]) =>\n        queryClient.setQueryData(key, value)\n      );\n    },\n    onSuccess: (data) => {\n      invalidateLists();\n      queryClient.setQueryData(detailKey(data.id), data);\n    },\n  });\n\n  const update = useMutation({\n    mutationFn: (args: { id: string; payload: MutationOptions }) =>\n      updateDiary(args.id, userId, args.payload, {\n        onUploadProgress: args.payload.onUploadProgress,\n      }),\n    onMutate: async ({ id, payload }) => {\n      await queryClient.cancelQueries({ queryKey: [\"diaries\", userId] });\n      const previous = queryClient.getQueriesData<Diary[]>({\n        queryKey: [\"diaries\", userId],\n      });\n\n      updateCachedLists((item) =>\n        item.id === id\n          ? { ...item, content: payload.content, date: payload.date }\n          : item\n      );\n\n      return { previous };\n    },\n    onError: (_err, _vars, context) => {\n      context?.previous?.forEach(([key, value]) =>\n        queryClient.setQueryData(key, value)\n      );\n    },\n    onSuccess: (data) => {\n      invalidateLists();\n      queryClient.setQueryData(detailKey(data.id), data);\n    },\n  });\n\n  const remove = useMutation({\n    mutationFn: (id: string) => deleteDiary(id),\n    onMutate: async (id: string) => {\n      await queryClient.cancelQueries({ queryKey: [\"diaries\", userId] });\n      const previous = queryClient.getQueriesData<Diary[]>({\n        queryKey: [\"diaries\", userId],\n      });\n\n      updateCachedLists((item) => (item.id === id ? null : item));\n\n      return { previous };\n    },\n    onError: (_err, _vars, context) => {\n      context?.previous?.forEach(([key, value]) =>\n        queryClient.setQueryData(key, value)\n      );\n    },\n    onSuccess: () => {\n      invalidateLists();\n    },\n  });\n\n  return { create, update, remove };\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2270, "column": 0}, "map": {"version":3,"sources":["file:///Users/maccrey/Development/Loglingo/src/components/auth/AuthGate.tsx"],"sourcesContent":["\"use client\";\n\nimport { useMemo, type ReactNode } from \"react\";\nimport { useAuth } from \"@/application/auth/AuthProvider\";\nimport { Button } from \"@/components/ui/Button\";\nimport { Card, CardContent, CardFooter, CardHeader, CardTitle } from \"@/components/ui/Card\";\nimport { routing } from \"@/i18n/routing\";\nimport { useLocale, useTranslations } from \"next-intl\";\nimport { Languages, Loader2, NotebookPen, ShieldCheck, Sparkles } from \"lucide-react\";\n\ntype AuthGateProps = {\n  children: ReactNode;\n};\n\nexport function AuthGate({ children }: AuthGateProps) {\n  const { user, loading, signInWithGoogle } = useAuth();\n  const t = useTranslations(\"auth\");\n  const locale = useLocale();\n\n  const languageList = useMemo(() => {\n    try {\n      const displayNames = new Intl.DisplayNames([locale], { type: \"language\" });\n      return routing.locales\n        .map((code) => displayNames.of(code) || code)\n        .join(\" ¬∑ \");\n    } catch (_error) {\n      return routing.locales.join(\" ¬∑ \");\n    }\n  }, [locale]);\n\n  if (loading) {\n    return (\n      <div className=\"flex min-h-screen items-center justify-center gap-3\">\n        <Loader2 className=\"h-6 w-6 animate-spin text-primary\" aria-hidden />\n        <p className=\"text-sm text-muted-foreground\">{t(\"loading\")}</p>\n      </div>\n    );\n  }\n\n  if (!user) {\n    const steps = [\n      { icon: NotebookPen, text: t(\"steps.write\") },\n      { icon: Sparkles, text: t(\"steps.review\") },\n      { icon: ShieldCheck, text: t(\"steps.save\") },\n    ];\n\n    return (\n      <div className=\"flex min-h-screen items-center justify-center px-4 py-10\">\n        <Card className=\"w-full max-w-4xl border-white/10 bg-gradient-to-b from-white/5 to-white/0\">\n          <CardHeader className=\"space-y-3 text-center\">\n            <CardTitle className=\"text-3xl font-bold text-foreground\">{t(\"title\")}</CardTitle>\n            <p className=\"text-sm text-muted-foreground\">{t(\"description\")}</p>\n            <p className=\"text-sm font-medium text-primary\">{t(\"requirement\")}</p>\n            <p className=\"text-xs text-muted-foreground\">{t(\"after_login\")}</p>\n          </CardHeader>\n\n          <CardContent className=\"grid gap-4 md:grid-cols-3\">\n            {steps.map((step) => {\n              const Icon = step.icon;\n              return (\n                <div\n                  key={step.text}\n                  className=\"flex items-start gap-3 rounded-xl border border-white/10 bg-white/5 p-4\"\n                >\n                  <Icon className=\"h-5 w-5 text-primary\" aria-hidden />\n                  <p className=\"text-sm leading-relaxed text-foreground\">{step.text}</p>\n                </div>\n              );\n            })}\n            <div className=\"md:col-span-3\">\n              <div className=\"flex items-start gap-3 rounded-xl border border-white/10 bg-white/5 p-4\">\n                <Languages className=\"h-5 w-5 text-primary\" aria-hidden />\n                <div>\n                  <p className=\"text-sm font-medium text-foreground\">{t(\"languages_label\")}</p>\n                  <p className=\"text-sm text-muted-foreground\">{languageList}</p>\n                </div>\n              </div>\n            </div>\n          </CardContent>\n\n          <CardFooter className=\"flex flex-col items-center gap-3\">\n            <Button\n              size=\"lg\"\n              className=\"w-full bg-primary text-primary-foreground hover:bg-primary/90 border border-primary/60 shadow-lg shadow-primary/30 md:w-auto\"\n              onClick={() => signInWithGoogle()}\n            >\n              {t(\"cta\")}\n            </Button>\n          </CardFooter>\n        </Card>\n      </div>\n    );\n  }\n\n  return <>{children}</>;\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;;;AARA;;;;;;;;AAcO,SAAS,SAAS,EAAE,QAAQ,EAAiB;;IAClD,MAAM,EAAE,IAAI,EAAE,OAAO,EAAE,gBAAgB,EAAE,GAAG,IAAA,oLAAO;IACnD,MAAM,IAAI,IAAA,uOAAe,EAAC;IAC1B,MAAM,SAAS,IAAA,6MAAS;IAExB,MAAM,eAAe,IAAA,mMAAO;0CAAC;YAC3B,IAAI;gBACF,MAAM,eAAe,IAAI,KAAK,YAAY,CAAC;oBAAC;iBAAO,EAAE;oBAAE,MAAM;gBAAW;gBACxE,OAAO,+JAAO,CAAC,OAAO,CACnB,GAAG;sDAAC,CAAC,OAAS,aAAa,EAAE,CAAC,SAAS;qDACvC,IAAI,CAAC;YACV,EAAE,OAAO,QAAQ;gBACf,OAAO,+JAAO,CAAC,OAAO,CAAC,IAAI,CAAC;YAC9B;QACF;yCAAG;QAAC;KAAO;IAEX,IAAI,SAAS;QACX,qBACE,wNAAC;YAAI,WAAU;;8BACb,wNAAC,0PAAO;oBAAC,WAAU;oBAAoC,aAAW;;;;;;8BAClE,wNAAC;oBAAE,WAAU;8BAAiC,EAAE;;;;;;;;;;;;IAGtD;IAEA,IAAI,CAAC,MAAM;QACT,MAAM,QAAQ;YACZ;gBAAE,MAAM,iQAAW;gBAAE,MAAM,EAAE;YAAe;YAC5C;gBAAE,MAAM,oPAAQ;gBAAE,MAAM,EAAE;YAAgB;YAC1C;gBAAE,MAAM,iQAAW;gBAAE,MAAM,EAAE;YAAc;SAC5C;QAED,qBACE,wNAAC;YAAI,WAAU;sBACb,cAAA,wNAAC,sKAAI;gBAAC,WAAU;;kCACd,wNAAC,4KAAU;wBAAC,WAAU;;0CACpB,wNAAC,2KAAS;gCAAC,WAAU;0CAAsC,EAAE;;;;;;0CAC7D,wNAAC;gCAAE,WAAU;0CAAiC,EAAE;;;;;;0CAChD,wNAAC;gCAAE,WAAU;0CAAoC,EAAE;;;;;;0CACnD,wNAAC;gCAAE,WAAU;0CAAiC,EAAE;;;;;;;;;;;;kCAGlD,wNAAC,6KAAW;wBAAC,WAAU;;4BACpB,MAAM,GAAG,CAAC,CAAC;gCACV,MAAM,OAAO,KAAK,IAAI;gCACtB,qBACE,wNAAC;oCAEC,WAAU;;sDAEV,wNAAC;4CAAK,WAAU;4CAAuB,aAAW;;;;;;sDAClD,wNAAC;4CAAE,WAAU;sDAA2C,KAAK,IAAI;;;;;;;mCAJ5D,KAAK,IAAI;;;;;4BAOpB;0CACA,wNAAC;gCAAI,WAAU;0CACb,cAAA,wNAAC;oCAAI,WAAU;;sDACb,wNAAC,uPAAS;4CAAC,WAAU;4CAAuB,aAAW;;;;;;sDACvD,wNAAC;;8DACC,wNAAC;oDAAE,WAAU;8DAAuC,EAAE;;;;;;8DACtD,wNAAC;oDAAE,WAAU;8DAAiC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;kCAMtD,wNAAC,4KAAU;wBAAC,WAAU;kCACpB,cAAA,wNAAC,0KAAM;4BACL,MAAK;4BACL,WAAU;4BACV,SAAS,IAAM;sCAEd,EAAE;;;;;;;;;;;;;;;;;;;;;;IAMf;IAEA,qBAAO;kBAAG;;AACZ;GAjFgB;;QAC8B,oLAAO;QACzC,uOAAe;QACV,6MAAS;;;KAHV"}}]
}